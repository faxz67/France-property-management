import{j as e}from"./index-DsBGyFQG.js";import{r as a}from"./router-DUq0sin2.js";import S from"./api-Bqs0zQX7.js";import{n as f}from"./Dashboard-CWmwHOAq.js";import{X as me,v as Ae,K as ue,j as ve,s as Me,x as _e,H as Le,N as Ne,B as we,k as Re,A as Fe}from"./icons-B5_qnxFz.js";/* empty css                            */import"./vendor-Bzgz95E1.js";import"./utils-B9HHbEsj.js";import"./charts-DdKZH6bc.js";const De=({propertyId:w,onClose:E})=>{const[C,O]=a.useState([]),[k,F]=a.useState(!1),[_,D]=a.useState(!1),[y,g]=a.useState(""),[j,I]=a.useState(null),[T,A]=a.useState([]);a.useEffect(()=>{M()},[w]),a.useEffect(()=>()=>{T.forEach(r=>{r.startsWith("blob:")&&URL.revokeObjectURL(r)})},[T]);const M=async()=>{try{F(!0);const v=((await S.getPropertyPhotos(w)).data?.data?.photos||[]).map(b=>({...b,file_url:f(b.file_url)}));O(v)}catch(r){console.error("Error fetching photos:",r),g(r.userMessage||"Failed to fetch photos")}finally{F(!1)}},$=r=>{const d=r.target.files;if(d&&d.length>0){I(d);const v=[];for(let b=0;b<d.length;b++)v.push(URL.createObjectURL(d[b]));A(v)}},J=async()=>{if(!j||j.length===0){g("Please select at least one photo");return}D(!0),g("");try{const r=new FormData;for(let b=0;b<j.length;b++)r.append("photos",j[b]);console.log("Uploading photos for property:",w),console.log("Files to upload:",j.length);const d=await S.uploadPropertyPhotos(w,r);console.log("Upload response:",d),I(null),A([]),await M();const v=document.getElementById("photo-upload");v&&(v.value=""),g("")}catch(r){console.error("Error uploading photos:",r),console.error("Error details:",r.response?.data),g(r.userMessage||r.message||"Failed to upload photos")}finally{D(!1)}},V=async r=>{if(confirm("Are you sure you want to delete this photo?"))try{await S.deletePropertyPhoto(w,r),await M()}catch(d){console.error("Error deleting photo:",d),g(d.userMessage||"Failed to delete photo")}},K=async r=>{try{await S.setPrimaryPropertyPhoto(w,r),await M()}catch(d){console.error("Error setting primary photo:",d),g(d.userMessage||"Failed to set primary photo")}},B=()=>{I(null),A([]);const r=document.getElementById("photo-upload");r&&(r.value="")},X=r=>r<1024?r+" B":r<1024*1024?(r/1024).toFixed(1)+" KB":(r/(1024*1024)).toFixed(1)+" MB";return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-5xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 sticky top-0 bg-white z-10",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"Property Photos"}),e.jsx("button",{onClick:E,className:"text-gray-400 hover:text-gray-600 transition-colors",title:"Close",children:e.jsx(me,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 bg-gray-50",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Upload New Photos"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{children:e.jsxs("label",{htmlFor:"photo-upload",className:"flex items-center justify-center w-full px-4 py-3 border border-gray-300 rounded-lg cursor-pointer bg-white hover:bg-gray-100 transition-colors",children:[e.jsx(Ae,{className:"w-5 h-5 mr-2 text-gray-600"}),e.jsx("span",{className:"text-gray-700",children:"Choose Photos (Max 10 files, 10MB each)"}),e.jsx("input",{id:"photo-upload",type:"file",accept:"image/*",multiple:!0,onChange:$,className:"hidden"})]})}),j&&j.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[j.length," file(s) selected"]}),e.jsx("button",{onClick:B,className:"text-sm text-red-600 hover:text-red-800",children:"Clear Selection"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:T.map((r,d)=>e.jsx("div",{className:"relative",children:e.jsx("img",{src:r,alt:`Preview ${d+1}`,className:"w-full h-24 object-cover rounded border border-gray-300"})},d))}),e.jsx("button",{onClick:J,disabled:_,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed",children:_?"Uploading...":"Upload Photos"})]})]})]}),y&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:y}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:["Uploaded Photos (",C.length,")"]}),k?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Loading photos..."})]}):C.length===0?e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[e.jsx(ue,{className:"w-12 h-12 mx-auto text-gray-400 mb-3"}),e.jsx("p",{className:"text-gray-600",children:"No photos uploaded yet"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Upload your first photo above"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:C.map(r=>e.jsxs("div",{className:"relative border border-gray-200 rounded-lg overflow-hidden bg-white shadow-sm hover:shadow-md transition-shadow",children:[r.is_primary&&e.jsxs("div",{className:"absolute top-2 left-2 bg-yellow-500 text-white px-2 py-1 rounded-full text-xs font-semibold flex items-center z-10",children:[e.jsx(ve,{className:"w-3 h-3 mr-1 fill-current"}),"Primary"]}),e.jsx("div",{className:"h-48 bg-gray-100",children:e.jsx("img",{src:f(r.file_url),alt:r.original_filename,className:"w-full h-full object-cover",onError:d=>{console.error("Image load error for:",r.file_url),d.currentTarget.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI2VlZSIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LXNpemU9IjE4IiBmaWxsPSIjYWFhIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSI+SW1hZ2UgRXJyb3I8L3RleHQ+PC9zdmc+"},onLoad:()=>{console.log("Image loaded successfully:",r.file_url)}})}),e.jsxs("div",{className:"p-3",children:[e.jsx("p",{className:"text-sm text-gray-900 truncate mb-1",title:r.original_filename,children:r.original_filename}),e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:X(r.file_size)}),e.jsxs("div",{className:"flex items-center gap-2",children:[!r.is_primary&&e.jsxs("button",{onClick:()=>K(r.id),className:"flex-1 flex items-center justify-center px-2 py-1.5 text-xs bg-yellow-50 text-yellow-700 rounded hover:bg-yellow-100 transition-colors",title:"Set as primary photo",children:[e.jsx(ve,{className:"w-3 h-3 mr-1"}),"Set Primary"]}),e.jsx("a",{href:f(r.file_url),target:"_blank",rel:"noopener noreferrer",download:!0,className:"flex items-center justify-center px-2 py-1.5 text-xs bg-blue-50 text-blue-700 rounded hover:bg-blue-100 transition-colors",title:"Download photo",children:e.jsx(Me,{className:"w-3 h-3"})}),e.jsx("button",{onClick:()=>V(r.id),className:"flex items-center justify-center px-2 py-1.5 text-xs bg-red-50 text-red-700 rounded hover:bg-red-100 transition-colors",title:"Delete photo",children:e.jsx(_e,{className:"w-3 h-3"})})]})]})]},r.id))})]})]}),e.jsx("div",{className:"flex items-center justify-end p-6 border-t border-gray-200 bg-gray-50",children:e.jsx("button",{onClick:E,className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"Close"})})]})})},Ze=()=>{const[w,E]=a.useState([]),[C,O]=a.useState(""),[k,F]=a.useState(""),[_,D]=a.useState(""),[y,g]=a.useState(""),[j,I]=a.useState("APARTMENT"),[T,A]=a.useState(""),[M,$]=a.useState(""),[J,V]=a.useState(""),[K,B]=a.useState(""),[X,r]=a.useState(""),[d,v]=a.useState(""),[b,Q]=a.useState(""),[pe,Y]=a.useState(""),[U,ee]=a.useState(null),[ae,W]=a.useState(null),[he,Z]=a.useState(!1),[xe,P]=a.useState(""),[fe,G]=a.useState(""),[q,le]=a.useState(!1),[ge,ne]=a.useState(null),[Pe,se]=a.useState(!1),[be,ie]=a.useState(null),[ce,ye]=a.useState(!1);a.useEffect(()=>{let s=!0;const m=async()=>{if(!(y.trim()||!k.trim()||!_.trim())&&!q&&s){ye(!0);try{const l=`${k}, ${_}, France`,n=await fetch(`https://api-adresse.data.gouv.fr/search/?q=${encodeURIComponent(l)}&limit=1`,{signal:AbortSignal.timeout(5e3)});if(!s)return;if(n.ok){const o=await n.json();if(o?.features&&Array.isArray(o.features)&&o.features.length>0){const i=o.features[0]?.properties?.postcode;i&&s&&g(i)}}}catch(l){l.name!=="AbortError"&&s&&console.log("Postal code auto-detection failed:",l?.message||l)}finally{s&&ye(!1)}}},t=setTimeout(()=>{m()},1e3);return()=>{s=!1,clearTimeout(t)}},[k,_,y,q]);const te=async()=>{try{if(!localStorage.getItem("token")){console.log("No token found, skipping properties API call"),E([]);return}Z(!0),P(""),console.log("üè† Fetching properties with photos...");const m=await S.listProperties();if(console.log("üì° API Response:",m.data),m.data?.success&&m.data?.data?.properties){const t=m.data.data.properties;if(!Array.isArray(t)){console.error("‚ùå Properties data is not an array:",t),E([]);return}console.log("üìã Raw properties from API:",t.length);const n=(await Promise.all(t.map(async o=>{if(!o||!o.id)return console.warn("‚ö†Ô∏è Invalid property data:",o),null;let i=[];try{const h=await S.getPropertyPhotos(o.id);if(h?.data?.success&&h?.data?.data?.photos){const z=h.data.data.photos;Array.isArray(z)?(i=z.map(p=>!p||!p.file_url?(console.warn("‚ö†Ô∏è Invalid photo data:",p),null):{...p,display_url:f(p.file_url||""),created_at_fr:p.created_at?new Date(p.created_at).toLocaleDateString("fr-FR"):"",updated_at_fr:p.updated_at?new Date(p.updated_at).toLocaleDateString("fr-FR"):null}).filter(p=>p!==null),console.log(`‚úÖ Loaded ${i.length} photo(s) for property ${o.id}`)):console.warn(`‚ö†Ô∏è Photos data is not an array for property ${o.id}:`,z)}else console.log(`‚ÑπÔ∏è No photos found for property ${o.id}`)}catch(h){console.warn(`‚ö†Ô∏è Could not fetch photos for property ${o.id}:`,h?.message||h),o.photo&&console.log(`‚ÑπÔ∏è Using fallback photo field for property ${o.id}`)}const L=i.find(h=>h.is_primary===!0)||i.find(h=>h.is_primary===1)||i[0]||null;return{...o,photos:i,primary_photo:L,display_title:o.title||o.name||"Propri√©t√© sans nom",display_address:`${o.address||""}, ${o.city||""}${o.postal_code?" "+o.postal_code:""}`.trim(),rent_formatted:new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(o.monthly_rent||o.rent||0),photo_count:i.length,has_photos:i.length>0,_debug:{hasPhotos:i.length>0,primaryPhotoExists:!!L,primaryPhotoUrl:L?.file_url||L?.display_url||null}}}))).filter(o=>o!==null);console.log("‚úÖ Properties fetched with photos:",n.length,"properties"),E(n)}else console.log("‚ùå Invalid response structure:",m.data),E([])}catch(s){console.error("‚ùå Failed to fetch properties:",s),P("Erreur lors du chargement des propri√©t√©s"),E([])}finally{Z(!1)}};a.useEffect(()=>{te()},[]);const ke=()=>{if(!C.trim())return"Title is required";if(C.trim().length<3)return"Le titre doit contenir au moins 3 caract√®res";if(C.trim().length>255)return"Le titre doit contenir moins de 255 caract√®res";if(!k.trim())return"L'adresse est requise";if(k.trim().length<5)return"L'adresse doit contenir au moins 5 caract√®res";if(!_.trim())return"La ville est requise";if(_.trim().length<2)return"La ville doit contenir au moins 2 caract√®res";if(!y.trim())return"Le code postal est requis";if(y.trim().length<3)return"Le code postal doit contenir au moins 3 caract√®res";if(y.trim().length>20)return"Le code postal doit contenir moins de 20 caract√®res";if(!j.trim())return"Le type de propri√©t√© est requis";const s=parseFloat(T);if(T&&(isNaN(s)||s<=0))return"Le montant du loyer doit √™tre un nombre positif";if(s>1e6)return"Le montant du loyer semble anormalement √©lev√©. Veuillez v√©rifier.";const m=M.trim();return m&&m.length>2e3?"La description doit contenir moins de 2000 caract√®res":null},Se=async s=>{s.preventDefault();const m=ke();if(m){P(m);return}if(!y.trim()){P("Le code postal est requis. Veuillez attendre la d√©tection automatique ou l'entrer manuellement.");return}Z(!0),P("");try{const t=new FormData;t.append("title",C.trim()),t.append("address",k.trim()),t.append("city",_.trim()),t.append("postal_code",y.trim()),t.append("property_type",j);const l=parseFloat(T);!isNaN(l)&&l>0&&t.append("monthly_rent",l.toString());const n=M.trim();n&&t.append("description",n),U?(t.append("photo",U),console.log("üì§ Appending photo to formData:",{fileName:U.name,fileSize:U.size,fileType:U.type})):console.log("‚ÑπÔ∏è No photo file to append");const o=parseInt(J);t.append("number_of_halls",(!isNaN(o)&&o>=0?o:0).toString());const i=parseInt(K);t.append("number_of_kitchens",(!isNaN(i)&&i>=0?i:0).toString());const L=parseInt(X);t.append("number_of_bathrooms",(!isNaN(L)&&L>=0?L:0).toString());const h=parseInt(d);t.append("number_of_parking_spaces",(!isNaN(h)&&h>=0?h:0).toString());const z=parseInt(b);t.append("number_of_rooms",(!isNaN(z)&&z>=0?z:0).toString());const p=parseInt(pe);t.append("number_of_gardens",(!isNaN(p)&&p>=0?p:0).toString());let N;try{q&&ge?N=await S.updateProperty(ge,t):N=await S.createProperty(t)}catch(c){console.error("‚ùå API Error:",c),console.error("‚ùå API Error details:",{message:c?.message,response:c?.response?.data,status:c?.response?.status,statusText:c?.response?.statusText});let u="√âchec de l'enregistrement de la propri√©t√©. Veuillez r√©essayer.";c?.response?.data?.error?u=c.response.data.error:c?.response?.data?.message?u=c.response.data.message:c?.message&&(u=c.message),c?.response?.status===400?u="Donn√©es invalides. Veuillez v√©rifier les informations saisies.":c?.response?.status===403?u="Acc√®s refus√©.":c?.response?.status===500?u="Erreur serveur. Veuillez r√©essayer plus tard.":(c?.code==="NETWORK_ERROR"||c?.message?.includes("Network"))&&(u="Erreur de connexion. V√©rifiez votre connexion internet."),P(u),Z(!1);return}if(!N?.data?.success){const c=N?.data?.error||N?.data?.message||"√âchec de l'enregistrement de la propri√©t√©";throw new Error(c)}N?.data?.warning&&(console.warn("‚ö†Ô∏è Property saved with warning:",N.data.warning),P(N.data.warning));const Ie=q?"Propri√©t√© mise √† jour avec succ√®s !":"Propri√©t√© cr√©√©e avec succ√®s !";N?.data?.warning||P(""),G(Ie),O(""),F(""),D(""),g(""),I("APARTMENT"),A(""),$(""),V(""),B(""),r(""),v(""),Q(""),Y(""),ee(null),W(null),le(!1),ne(null),se(!1);const re=N?.data?.data?.property?.id,Te=!!U;if(console.log("üîÑ Immediate refresh to show new property..."),await te(),re&&Te){console.log("üì∏ Photo was uploaded, verifying primary photo creation..."),console.log("   Created property ID:",re),console.log("   Response data:",N?.data?.data);const c=N?.data?.data?.property;if(c?.photos&&c.photos.length>0){console.log("‚úÖ Photos found in response:",c.photos.length);const x=c.photos.find(R=>R.is_primary===!0)||c.photos[0];x&&console.log("‚úÖ Primary photo in response:",{photoId:x.id,fileUrl:x.file_url,filePath:x.file_path})}await new Promise(x=>setTimeout(x,1500));let u=0,de=!1;for(;u<3&&!de;)try{const x=await S.getPropertyPhotos(re);if(console.log(`üì∏ Photo check attempt ${u+1}:`,x?.data),x?.data?.success&&x?.data?.data?.photos){const R=x.data.data.photos,H=R.find(oe=>oe.is_primary===!0||oe.is_primary===1)||R[0];H?(console.log(`‚úÖ Primary photo found for property ${re}:`,{photoId:H.id,isPrimary:H.is_primary,fileUrl:H.file_url,filePath:H.file_path,displayUrl:f(H.file_url||"")}),de=!0):(u++,u<3&&(console.log(`‚è≥ Retry ${u}/3: Waiting for primary photo...`),await new Promise(oe=>setTimeout(oe,1e3))))}else u++,u<3&&(console.log(`‚è≥ Retry ${u}/3: No photos yet, waiting...`),await new Promise(R=>setTimeout(R,1e3)))}catch(x){u++,console.warn(`‚ö†Ô∏è Error checking photos (attempt ${u}/3):`,x?.message||x),u<3&&await new Promise(R=>setTimeout(R,1e3))}await te(),de?console.log("‚úÖ Primary photo verified and displayed"):(console.warn(`‚ö†Ô∏è Primary photo not found after ${u} attempts`),console.warn("   This could indicate:"),console.warn("   - Photo upload failed silently"),console.warn("   - PropertyPhoto record was not created"),console.warn("   - Database transaction issue"))}else console.log("‚úÖ Property created without photo, list refreshed");setTimeout(()=>{G("")},3e3)}catch(t){console.error("‚ùå Property submission error:",t),console.error("‚ùå Error details:",{message:t?.message,response:t?.response?.data,status:t?.response?.status,statusText:t?.response?.statusText,stack:t?.stack});let l="√âchec de l'enregistrement de la propri√©t√©. Veuillez r√©essayer.";if(t?.response?.data){const n=t.response.data;n.details&&Array.isArray(n.details)?l=`Erreurs de validation : ${n.details.map(i=>i.msg||i.message||i).join(", ")}`:n.error?l=n.error:n.message&&(l=n.message)}else t?.userMessage?l=t.userMessage:t?.message&&(l=t.message);t?.response?.status===400?l="Donn√©es invalides. Veuillez v√©rifier les informations saisies.":t?.response?.status===403?l="Acc√®s refus√©.":t?.response?.status===500?l="Erreur serveur. Veuillez r√©essayer plus tard.":(t?.code==="NETWORK_ERROR"||t?.message?.includes("Network"))&&(l="Erreur de connexion. V√©rifiez votre connexion internet."),P(l),G("")}finally{Z(!1)}},Ce=s=>{O(s.title),F(s.address),D(s.city),g(s.postal_code||""),I(s.property_type),A(s.monthly_rent?.toString()||""),$(s.description||""),V(s.number_of_halls?.toString()||""),B(s.number_of_kitchens?.toString()||""),r(s.number_of_bathrooms?.toString()||""),v(s.number_of_parking_spaces?.toString()||""),Q(s.number_of_rooms?.toString()||""),Y(s.number_of_gardens?.toString()||""),le(!0),ne(s.id.toString()),se(!0)},je=()=>{O(""),F(""),D(""),g(""),I("APARTMENT"),A(""),$(""),V(""),B(""),r(""),v(""),Q(""),Y(""),ee(null),W(null),le(!1),ne(null),se(!1),P(""),G("")},Ee=async s=>{if(confirm("Delete this property?"))try{await S.deleteProperty(s.toString()),await te()}catch(m){alert(m?.response?.data?.error||"Failed to delete")}};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-4 md:mb-6 fade-in-soft",children:[e.jsxs("div",{className:"slide-in-left",children:[e.jsx("h1",{className:"text-xl md:text-2xl font-bold text-gray-900",children:"Propri√©t√©s"}),e.jsx("p",{className:"text-gray-600 mt-1 text-sm md:text-base",children:"G√©rer vos propri√©t√©s et leurs photos"})]}),e.jsx("div",{className:"slide-in-right w-full sm:w-auto",children:e.jsxs("button",{onClick:()=>{P(""),G(""),se(!0)},className:"bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center justify-center space-x-2 hover:bg-blue-700 smooth-transition hover-lift-strong glow-effect w-full sm:w-auto text-sm md:text-base",children:[e.jsx(Le,{className:"w-4 h-4 smooth-transition"}),e.jsx("span",{children:"Ajouter Propri√©t√©"})]})})]}),Pe&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-3 sm:p-4 md:p-6 overflow-y-auto fade-in",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-3xl mx-auto my-auto max-h-[95vh] overflow-y-auto modal-enter",children:[e.jsx("div",{className:"sticky top-0 bg-white z-10 px-4 sm:px-6 pt-4 sm:pt-6 pb-3 border-b border-gray-200 rounded-t-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg sm:text-xl md:text-2xl font-semibold text-gray-900",children:q?"Modifier la Propri√©t√©":"Ajouter une Nouvelle Propri√©t√©"}),e.jsx("button",{onClick:je,className:"text-gray-400 hover:text-gray-600 p-1 sm:p-2 transition-colors",title:"Fermer le modal","aria-label":"Fermer le modal",children:e.jsx(me,{className:"w-5 h-5 sm:w-6 sm:h-6"})})]})}),e.jsxs("form",{onSubmit:Se,className:"px-4 sm:px-6 py-4 sm:py-6 space-y-4 sm:space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-5",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm sm:text-base font-medium text-gray-700 mb-1.5 sm:mb-2",children:"Titre *"}),e.jsx("input",{className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",placeholder:"Titre de la Propri√©t√©",value:C,onChange:s=>O(s.target.value),required:!0})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm sm:text-base font-medium text-gray-700 mb-1.5 sm:mb-2",children:"Adresse *"}),e.jsx("input",{className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",placeholder:"Adresse de la Propri√©t√©",value:k,onChange:s=>F(s.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm sm:text-base font-medium text-gray-700 mb-1.5 sm:mb-2",children:"Ville *"}),e.jsx("input",{className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",placeholder:"Ville",value:_,onChange:s=>D(s.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm sm:text-base font-medium text-gray-700 mb-1.5 sm:mb-2",children:["Code Postal *",ce&&e.jsx("span",{className:"ml-2 text-xs text-gray-500",children:"(Recherche...)"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",placeholder:"Code Postal",value:y,onChange:s=>g(s.target.value),required:!0}),ce&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"})})]}),k&&_&&!y&&!ce&&e.jsx("p",{className:"mt-1.5 text-xs sm:text-sm text-gray-500",children:"Le code postal sera d√©tect√© automatiquement"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm sm:text-base font-medium text-gray-700 mb-1.5 sm:mb-2",children:"Type de Propri√©t√© *"}),e.jsxs("select",{className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white",value:j,onChange:s=>I(s.target.value),required:!0,"aria-label":"Type de Propri√©t√©",id:"property-type",children:[e.jsx("option",{value:"APARTMENT",children:"Appartement"}),e.jsx("option",{value:"HOUSE",children:"Maison"}),e.jsx("option",{value:"STUDIO",children:"Studio"}),e.jsx("option",{value:"OTHER",children:"Autre"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm sm:text-base font-medium text-gray-700 mb-1.5 sm:mb-2",children:"Loyer Mensuel (‚Ç¨)"}),e.jsx("input",{className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",placeholder:"0.00",type:"number",step:"0.01",min:"0",value:T,onChange:s=>A(s.target.value)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm sm:text-base font-medium text-gray-700 mb-1.5 sm:mb-2",children:"Description"}),e.jsx("textarea",{className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all resize-y",placeholder:"Description de la Propri√©t√©",value:M,onChange:s=>$(s.target.value),rows:3})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-4 sm:pt-5 mt-4 sm:mt-5",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 mb-4 sm:mb-5",children:"D√©tails de la Propri√©t√© (Optionnel)"}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1.5 sm:mb-2",children:"Nombre de Halls"}),e.jsx("input",{className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",placeholder:"0",type:"number",min:"0",value:J,onChange:s=>V(s.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1.5 sm:mb-2",children:"Nombre de Cuisines"}),e.jsx("input",{className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",placeholder:"0",type:"number",min:"0",value:K,onChange:s=>B(s.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1.5 sm:mb-2",children:"Nombre de Salles de Bain"}),e.jsx("input",{className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",placeholder:"0",type:"number",min:"0",value:X,onChange:s=>r(s.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1.5 sm:mb-2",children:"Places de Parking"}),e.jsx("input",{className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",placeholder:"0",type:"number",min:"0",value:d,onChange:s=>v(s.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1.5 sm:mb-2",children:"Nombre de Chambres"}),e.jsx("input",{className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",placeholder:"0",type:"number",min:"0",value:b,onChange:s=>Q(s.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1.5 sm:mb-2",children:"Nombre de Jardins"}),e.jsx("input",{className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",placeholder:"0",type:"number",min:"0",value:pe,onChange:s=>Y(s.target.value)})]})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-4 sm:pt-5 mt-4 sm:mt-5",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 mb-3 sm:mb-4",children:"Image de la Propri√©t√©"}),e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-3 sm:gap-4",children:[e.jsxs("label",{className:"flex flex-col items-center justify-center w-full sm:w-32 h-32 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-blue-500 hover:bg-blue-50 transition-colors",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[e.jsx(Ne,{className:"w-6 h-6 sm:w-8 sm:h-8 text-gray-400 mb-2"}),e.jsxs("p",{className:"text-xs sm:text-sm text-gray-600 text-center px-2",children:[U?"Changer":"Ajouter"," une image"]})]}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:s=>{const m=s.target.files?.[0]||null;if(ee(m||null),m){const t=URL.createObjectURL(m);W(t)}else W(null)}})]}),ae&&e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:ae,alt:"Aper√ßu",className:"w-32 h-32 sm:w-40 sm:h-40 object-cover rounded-lg border-2 border-gray-200 shadow-sm"}),e.jsx("button",{type:"button",onClick:()=>{ee(null),W(null)},className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1.5 hover:bg-red-600 transition-colors shadow-md",title:"Supprimer l'image","aria-label":"Supprimer l'image",children:e.jsx(me,{className:"w-4 h-4"})})]})]}),!ae&&e.jsx("p",{className:"text-xs sm:text-sm text-gray-500",children:"Format accept√© : JPG, PNG, GIF. Taille recommand√©e : 800x600px"})]})]}),xe&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-3 sm:px-4 py-2.5 sm:py-3 rounded-lg",children:[e.jsx("p",{className:"font-semibold text-sm sm:text-base",children:"Erreur"}),e.jsx("p",{className:"text-xs sm:text-sm mt-1",children:xe})]}),fe&&e.jsxs("div",{className:"bg-green-50 border border-green-200 text-green-700 px-3 sm:px-4 py-2.5 sm:py-3 rounded-lg",children:[e.jsx("p",{className:"font-semibold text-sm sm:text-base",children:"Succ√®s"}),e.jsx("p",{className:"text-xs sm:text-sm mt-1",children:fe})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center justify-end gap-3 sm:gap-4 pt-4 sm:pt-5 mt-4 sm:mt-5 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:je,className:"w-full sm:w-auto px-5 sm:px-6 py-2.5 sm:py-3 text-sm sm:text-base font-medium text-gray-700 bg-white border-2 border-gray-300 rounded-lg hover:bg-gray-50 hover:border-gray-400 transition-all duration-200",children:"Annuler"}),e.jsx("button",{type:"submit",disabled:he,className:"w-full sm:w-auto px-5 sm:px-6 py-2.5 sm:py-3 text-sm sm:text-base font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-200 shadow-sm hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:shadow-none",children:he?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Enregistrement..."})]}):q?"Mettre √† Jour la Propri√©t√©":"Ajouter Propri√©t√©"})]})]})]})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:w&&Array.isArray(w)&&w.length>0?w.map((s,m)=>e.jsxs("div",{className:`bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden nav-hover-lift nav-item-enter-delay-${Math.min(m+1,7)}`,children:[e.jsxs("div",{className:"h-48 bg-gray-100 flex items-center justify-center relative group",children:[s.primary_photo?e.jsx("img",{src:s.primary_photo.display_url||f(s.primary_photo.file_url||""),alt:s.display_title,crossOrigin:"anonymous",loading:"lazy",className:"w-full h-48 object-cover transition-transform duration-300 group-hover:scale-105",onError:t=>{const l=t.currentTarget.src;if(console.warn(`‚ùå Failed to load primary image for property ${s.id}:`,{propertyId:s.id,primaryPhoto:s.primary_photo,original_url:s.primary_photo?.file_url,display_url:s.primary_photo?.display_url,current_src:l,normalized_url:f(s.primary_photo?.file_url||""),hasPhotos:(s.photos?.length||0)>0,photoCount:s.photo_count}),s.photos&&s.photos.length>0&&s.photos[0]?.file_url){const i=f(s.photos[0].file_url);if(l!==i){t.currentTarget.src=i;return}}if(s.photo&&l!==f(s.photo)){t.currentTarget.src=f(s.photo);return}const n=t.currentTarget;n.style.display="none";const o=n.parentElement;if(o&&!o.querySelector(".placeholder-shown")){const i=document.createElement("div");i.className="placeholder-shown flex flex-col items-center justify-center h-full w-full bg-gradient-to-br from-blue-50 to-indigo-100",i.innerHTML=`
                        <div class="w-20 h-20 bg-white/80 rounded-2xl flex items-center justify-center mb-3 shadow-lg">
                          <svg class="w-10 h-10 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                          </svg>
                        </div>
                        <p class="text-xs text-blue-600 font-medium">Aucune photo</p>
                      `,o.appendChild(i)}},onLoad:t=>{console.log(`‚úÖ Primary image loaded successfully for property ${s.id}:`,{url:t.currentTarget.src,propertyId:s.id})}}):s.photos&&s.photos.length>0?e.jsx("img",{src:s.photos[0]?.display_url||f(s.photos[0]?.file_url||""),alt:s.display_title,crossOrigin:"anonymous",loading:"lazy",className:"w-full h-48 object-cover transition-transform duration-300 group-hover:scale-105",onError:t=>{if(console.warn(`‚ùå Failed to load first image for property ${s.id}:`,{original_url:s.photos?.[0]?.file_url,display_url:s.photos?.[0]?.display_url,current_src:t.currentTarget.src,error:"Image failed to load - check CORS/CSP headers"}),s.photo&&t.currentTarget.src!==f(s.photo)){t.currentTarget.src=f(s.photo);return}const l=t.currentTarget;l.style.display="none";const n=l.parentElement;if(n&&!n.querySelector(".placeholder-shown")){const o=document.createElement("div");o.className="placeholder-shown flex flex-col items-center justify-center h-full w-full bg-gradient-to-br from-blue-50 to-indigo-100",o.innerHTML=`
                        <div class="w-20 h-20 bg-white/80 rounded-2xl flex items-center justify-center mb-3 shadow-lg">
                          <svg class="w-10 h-10 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                          </svg>
                        </div>
                        <p class="text-xs text-blue-600 font-medium">Aucune photo</p>
                      `,n.appendChild(o)}},onLoad:()=>{console.log(`‚úÖ First image loaded successfully for property ${s.id}`)}}):s.photo?e.jsx("img",{src:f(s.photo),alt:s.display_title,crossOrigin:"anonymous",loading:"lazy",className:"w-full h-48 object-cover transition-transform duration-300 group-hover:scale-105",onError:t=>{console.warn(`‚ùå Failed to load property photo for property ${s.id}:`,{photo_url:s.photo,current_src:t.currentTarget.src,error:"Image failed to load"});const l=t.currentTarget;l.style.display="none";const n=l.parentElement;if(n&&!n.querySelector(".placeholder-shown")){const o=document.createElement("div");o.className="placeholder-shown flex items-center justify-center h-full w-full bg-gray-200",o.innerHTML='<svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path></svg>',n.appendChild(o)}},onLoad:()=>{console.log(`‚úÖ Property photo loaded successfully for property ${s.id}`)}}):e.jsx("div",{className:"flex items-center justify-center h-full w-full bg-gray-200",children:e.jsx(we,{className:"w-12 h-12 text-gray-400"})}),s.photo_count>0&&e.jsxs("div",{className:"absolute top-2 left-2 bg-black bg-opacity-50 text-white px-2 py-1 rounded-full text-xs flex items-center gap-1",children:[e.jsx(Ne,{className:"w-3 h-3"}),s.photo_count]}),s.rent_formatted&&e.jsxs("div",{className:"absolute top-2 right-2 bg-blue-600 text-white px-3 py-1 rounded-full text-sm font-semibold",children:[s.rent_formatted,"/mois"]}),e.jsx("div",{className:"absolute bottom-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:e.jsx("button",{onClick:()=>ie(s.id),className:"bg-white bg-opacity-90 text-gray-700 p-2 rounded-full hover:bg-opacity-100 transition-all duration-200 nav-transition nav-hover-scale",title:"G√©rer les photos",children:e.jsx(ue,{className:"w-4 h-4"})})})]}),e.jsxs("div",{className:"p-5",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:s.display_title}),e.jsxs("div",{className:"flex items-center text-gray-600 mb-2",children:[e.jsx(Re,{className:"w-4 h-4 mr-1 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:s.display_address})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs text-gray-600 mb-3",children:[e.jsxs("div",{children:["Halls: ",e.jsx("span",{className:"font-medium",children:s.number_of_halls??0})]}),e.jsxs("div",{children:["Cuisines: ",e.jsx("span",{className:"font-medium",children:s.number_of_kitchens??0})]}),e.jsxs("div",{children:["Salles de bain: ",e.jsx("span",{className:"font-medium",children:s.number_of_bathrooms??0})]}),e.jsxs("div",{children:["Parking: ",e.jsx("span",{className:"font-medium",children:s.number_of_parking_spaces??0})]}),e.jsxs("div",{children:["Chambres: ",e.jsx("span",{className:"font-medium",children:s.number_of_rooms??0})]}),e.jsxs("div",{children:["Jardins: ",e.jsx("span",{className:"font-medium",children:s.number_of_gardens??0})]})]}),e.jsxs("div",{className:"flex items-center text-gray-500 text-sm mb-3",children:[e.jsxs("span",{children:[s.city,s.postal_code?" "+s.postal_code:""]}),e.jsx("span",{className:"mx-2",children:"‚Ä¢"}),e.jsx("span",{className:"capitalize",children:s.property_type.toLowerCase()})]}),(s.number_of_rooms||s.number_of_bathrooms||s.number_of_kitchens||s.number_of_halls||s.number_of_parking_spaces||s.number_of_gardens)&&e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[s.number_of_rooms&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[s.number_of_rooms," chambre",s.number_of_rooms!==1?"s":""]}),s.number_of_bathrooms&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[s.number_of_bathrooms," salle",s.number_of_bathrooms!==1?"s":""," de bain"]}),s.number_of_kitchens&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:[s.number_of_kitchens," cuisine",s.number_of_kitchens!==1?"s":""]}),s.number_of_halls&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:[s.number_of_halls," hall",s.number_of_halls!==1?"s":""]}),s.number_of_parking_spaces&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:[s.number_of_parking_spaces," place",s.number_of_parking_spaces!==1?"s":""," de parking"]}),s.number_of_gardens&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-emerald-100 text-emerald-800",children:[s.number_of_gardens," jardin",s.number_of_gardens!==1?"s":""]})]}),s.description&&e.jsx("p",{className:"text-gray-700 text-sm mb-4 line-clamp-2",children:s.description}),e.jsxs("div",{className:"flex justify-between items-center pt-3 border-t border-gray-100",children:[e.jsxs("button",{onClick:()=>ie(s.id),className:"flex items-center text-green-600 hover:text-green-800 text-sm font-medium nav-transition nav-hover-scale",children:[e.jsx(ue,{className:"w-4 h-4 mr-1"}),"Photos (",s.photo_count||0,")"]}),e.jsxs("button",{onClick:()=>Ce(s),className:"flex items-center text-blue-600 hover:text-blue-800 text-sm font-medium nav-transition nav-hover-scale",children:[e.jsx(Fe,{className:"w-4 h-4 mr-1"}),"Modifier"]}),e.jsxs("button",{onClick:()=>Ee(s.id),className:"flex items-center text-red-600 hover:text-red-800 text-sm font-medium nav-transition nav-hover-scale",children:[e.jsx(_e,{className:"w-4 h-4 mr-1"}),"Supprimer"]})]})]})]},s.id)):e.jsxs("div",{className:"col-span-full flex flex-col items-center justify-center py-12 text-gray-500",children:[e.jsx(we,{className:"w-16 h-16 mb-4 text-gray-400"}),e.jsx("p",{className:"text-lg font-medium",children:"Aucune propri√©t√© trouv√©e"}),e.jsx("p",{className:"text-sm mt-2",children:"Commencez par ajouter votre premi√®re propri√©t√©"})]})}),be&&e.jsx(De,{propertyId:be,onClose:()=>ie(null)})]})};export{Ze as default};

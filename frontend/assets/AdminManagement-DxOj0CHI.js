import{j as e}from"./index-rAghrxu1.js";import{r as a}from"./router-DUq0sin2.js";import{listAdmins as z,createAdmin as H,deleteAdmin as B,updateAdmin as J}from"./api-XfUXylTc.js";import"./vendor-Bzgz95E1.js";import"./icons-B-WyEUkg.js";import"./utils-B9HHbEsj.js";const Z=()=>{const[k,i]=a.useState([]),[c,F]=a.useState(""),[u,M]=a.useState(""),[m,P]=a.useState(""),[p,q]=a.useState(""),[h,R]=a.useState("ADMIN"),[d,l]=a.useState(!1),[g,r]=a.useState(""),[x,n]=a.useState(""),[b,L]=a.useState(null),[N,j]=a.useState(""),[v,A]=a.useState(""),[y,w]=a.useState(""),[E,C]=a.useState(""),[S,I]=a.useState("ADMIN"),[_,D]=a.useState(!0),f=async()=>{try{if(!localStorage.getItem("token")){console.log("No token found, skipping admins API call"),i([]),r("No authentication token");return}console.log("Fetching admins with token...");const t=await z();console.log("Admins response:",t.data),t.data&&t.data.success?(i(t.data.data?.admins||[]),r("")):(i([]),r("Failed to fetch admins"))}catch(s){console.error("Error fetching admins:",s),i([]),r(s.response?.data?.error||s.message||"Failed to fetch admins")}};a.useEffect(()=>{f()},[]);const U=async s=>{if(s.preventDefault(),l(!0),r(""),n(""),!c.trim()){r("First name is required"),l(!1);return}if(!u.trim()){r("Last name is required"),l(!1);return}if(!m.trim()){r("Email is required"),l(!1);return}if(!p.trim()){r("Password is required"),l(!1);return}if(p.length<6){r("Password must be at least 6 characters"),l(!1);return}try{console.log("Creating admin with data:",{name:`${c} ${u}`.trim(),email:m,password:"[HIDDEN]",role:h});const t=await H({name:`${c} ${u}`.trim(),email:m,password:p,role:h});console.log("Create admin response:",t.data),t.data&&t.data.success?(n("Admin created successfully!"),F(""),M(""),P(""),q(""),R("ADMIN"),await f()):r("Failed to create admin")}catch(t){console.error("Error creating admin:",t),r(t?.response?.data?.error||"Failed to create admin")}finally{l(!1)}},T=async(s,t)=>{if(window.confirm(`Are you sure you want to delete admin: ${t}?`)){l(!0),r(""),n("");try{const o=await B(s);console.log("Delete admin response:",o.data),o.data&&o.data.success?(n("Admin deleted successfully!"),await f()):r("Failed to delete admin")}catch(o){console.error("Error deleting admin:",o),r(o?.response?.data?.error||"Failed to delete admin")}finally{l(!1)}}},V=s=>{L(s.id);const t=(s.name||s.fullname||"").split(" ");j(t[0]||""),A(t.slice(1).join(" ")||""),w(s.email||""),C(""),I(s.role||"ADMIN"),D(s.status==="ACTIVE"||s.is_active===!0),r(""),n("")},$=()=>{L(null),j(""),A(""),w(""),C(""),I("ADMIN"),D(!0),r(""),n("")},G=async s=>{if(s.preventDefault(),!!b){l(!0),r(""),n("");try{const t={};(N.trim()||v.trim())&&(t.name=`${N} ${v}`.trim()),y.trim()&&(t.email=y.trim()),E.trim()&&(t.password=E.trim()),S&&(t.role=S),t.status=_?"ACTIVE":"INACTIVE",console.log("Update payload:",t);const o=await J(b,t);console.log("Update admin response:",o.data),o.data&&o.data.success?(n("Admin updated successfully!"),$(),await f()):r("Failed to update admin")}catch(t){console.error("Error updating admin:",t),r(t?.response?.data?.error||"Failed to update admin")}finally{l(!1)}}};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Gestion des Administrateurs"}),e.jsx("div",{className:"flex items-center space-x-4",children:e.jsx("div",{className:"text-sm text-gray-500",children:"Gérer les administrateurs système"})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Ajouter un Nouvel Administrateur"}),e.jsxs("form",{onSubmit:U,className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4",autoComplete:"off",children:[e.jsx("input",{className:"border p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Prénom",value:c,onChange:s=>F(s.target.value),required:!0,autoComplete:"off"}),e.jsx("input",{className:"border p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Nom de Famille",value:u,onChange:s=>M(s.target.value),required:!0,autoComplete:"off"}),e.jsx("input",{className:"border p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Email",type:"email",value:m,onChange:s=>P(s.target.value),required:!0,autoComplete:"off"}),e.jsx("input",{className:"border p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Mot de passe",type:"password",value:p,onChange:s=>q(s.target.value),required:!0,minLength:8,autoComplete:"new-password"}),e.jsxs("select",{className:"border p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:h,onChange:s=>R(s.target.value),children:[e.jsx("option",{value:"ADMIN",children:"Administrateur"}),e.jsx("option",{value:"SUPER_ADMIN",children:"Super Administrateur"})]}),e.jsx("button",{disabled:d,className:"bg-blue-600 hover:bg-blue-700 text-white rounded-lg p-3 transition-colors disabled:opacity-50",children:d?"Ajout...":"Ajouter Admin"})]}),g&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-red-600",children:g})}),x&&e.jsx("div",{className:"mt-4 p-3 bg-green-50 border border-green-200 rounded-lg",children:e.jsx("p",{className:"text-green-600",children:x})})]}),e.jsxs("div",{className:"bg-white rounded-lg border shadow-sm overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b bg-gray-50",children:e.jsx("h2",{className:"text-lg font-semibold",children:"Liste des Administrateurs"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left border-b bg-gray-50",children:[e.jsx("th",{className:"p-4 font-medium",children:"Nom"}),e.jsx("th",{className:"p-4 font-medium",children:"Email"}),e.jsx("th",{className:"p-4 font-medium",children:"Rôle"}),e.jsx("th",{className:"p-4 font-medium",children:"Statut"}),e.jsx("th",{className:"p-4 font-medium",children:"Créé"}),e.jsx("th",{className:"p-4 font-medium",children:"Actions"})]})}),e.jsxs("tbody",{children:[k.map(s=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-4",children:s.name||s.fullname}),e.jsx("td",{className:"p-4",children:s.email}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${s.role==="SUPER_ADMIN"?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"}`,children:s.role==="SUPER_ADMIN"?"Super Admin":"Administrateur"})}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${s.status==="ACTIVE"||s.is_active===!0?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.status==="ACTIVE"||s.is_active===!0?"Actif":"Inactif"})}),e.jsx("td",{className:"p-4 text-sm text-gray-600",children:s.created_at?new Date(s.created_at).toLocaleDateString():"N/A"}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>V(s),className:"text-blue-600 hover:text-blue-800 text-sm font-medium",disabled:d,children:"Modifier"}),e.jsx("button",{onClick:()=>T(s.id,s.email),className:"text-red-600 hover:text-red-800 text-sm font-medium",disabled:d,children:"Supprimer"})]})})]},s.id)),k.length===0&&e.jsx("tr",{children:e.jsx("td",{className:"p-8 text-center text-gray-500",colSpan:6,children:"Aucun administrateur trouvé. Ajoutez votre premier administrateur ci-dessus."})})]})]})})]}),b!==null&&e.jsxs("div",{className:"bg-white p-6 rounded-lg border shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Modifier l'Administrateur"}),e.jsxs("form",{onSubmit:G,className:"space-y-4",autoComplete:"off",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Prénom"}),e.jsx("input",{className:"w-full border p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Prénom",value:N,onChange:s=>j(s.target.value),required:!0,autoComplete:"off"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nom de Famille"}),e.jsx("input",{className:"w-full border p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Nom de Famille",value:v,onChange:s=>A(s.target.value),required:!0,autoComplete:"off"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{className:"w-full border p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Email",type:"email",value:y,onChange:s=>w(s.target.value),autoComplete:"off"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nouveau Mot de passe (optionnel)"}),e.jsx("input",{className:"w-full border p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Laisser vide pour conserver le mot de passe actuel",type:"password",value:E,onChange:s=>C(s.target.value),autoComplete:"new-password"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rôle"}),e.jsxs("select",{className:"w-full border p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:S,onChange:s=>I(s.target.value),children:[e.jsx("option",{value:"ADMIN",children:"Administrateur"}),e.jsx("option",{value:"SUPER_ADMIN",children:"Super Administrateur"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"editIsActive",checked:_,onChange:s=>D(s.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("label",{htmlFor:"editIsActive",className:"text-sm font-medium text-gray-700",children:"Compte Actif"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"submit",disabled:d,className:"bg-green-600 hover:bg-green-700 text-white rounded-lg px-6 py-2 transition-colors disabled:opacity-50",children:d?"Enregistrement...":"Enregistrer les Modifications"}),e.jsx("button",{type:"button",onClick:$,className:"bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-lg px-6 py-2 transition-colors",children:"Annuler"})]}),g&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-red-600",children:g})}),x&&e.jsx("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:e.jsx("p",{className:"text-green-600",children:x})})]})]})]})};export{Z as default};

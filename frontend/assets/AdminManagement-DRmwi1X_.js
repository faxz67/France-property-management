import{j as e}from"./index-BRkigiy4.js";import{r as o}from"./router-DUq0sin2.js";import{listAdmins as B,createAdmin as J,updateAdmin as _,deleteAdmin as K}from"./api-DQwSXtBv.js";import"./vendor-Bzgz95E1.js";import"./icons-ByKMif1I.js";import"./utils-B9HHbEsj.js";const te=()=>{const[D,u]=o.useState([]),[m,T]=o.useState(""),[p,L]=o.useState(""),[g,F]=o.useState(""),[h,P]=o.useState(""),[b,V]=o.useState("ADMIN"),[i,l]=o.useState(!1),[f,a]=o.useState(""),[x,n]=o.useState(""),[N,$]=o.useState(null),[j,v]=o.useState(""),[A,y]=o.useState(""),[E,w]=o.useState(""),[C,I]=o.useState(""),[S,M]=o.useState("ADMIN"),[q,k]=o.useState(!0),c=async()=>{try{if(!localStorage.getItem("token")){console.log("No token found, skipping admins API call"),u([]),a("No authentication token");return}console.log("Fetching admins with token...");const t=await B();console.log("Admins response:",t.data),t.data&&t.data.success?(u(t.data.data?.admins||[]),a("")):(u([]),a("Failed to fetch admins"))}catch(s){console.error("Error fetching admins:",s),u([]),a(s.response?.data?.error||s.message||"Failed to fetch admins")}};o.useEffect(()=>{c()},[]);const U=async s=>{if(s.preventDefault(),l(!0),a(""),n(""),!m.trim()){a("Le pr√©nom est requis"),l(!1);return}if(!p.trim()){a("Le nom de famille est requis"),l(!1);return}if(!g.trim()){a("L'email est requis"),l(!1);return}if(!h.trim()){a("Le mot de passe est requis"),l(!1);return}if(h.length<6){a("Le mot de passe doit contenir au moins 6 caract√®res"),l(!1);return}try{console.log("Creating admin with data:",{name:`${m} ${p}`.trim(),email:g,password:"[HIDDEN]",role:b});const t=await J({name:`${m} ${p}`.trim(),email:g,password:h,role:b});if(console.log("Create admin response:",t.data),t.data&&t.data.success)n("Administrateur cr√©√© avec succ√®s!"),T(""),L(""),F(""),P(""),V("ADMIN"),await c();else{const r=t.data?.error||"√âchec de la cr√©ation de l'administrateur";a(r),console.error("Failed to create admin:",t.data)}}catch(t){console.error("Error creating admin:",t);const r=t?.response?.data?.error||t?.message||"√âchec de la cr√©ation de l'administrateur. Veuillez r√©essayer.";a(r),t?.response?.data&&console.error("Error response data:",t.response.data)}finally{l(!1)}},z=async(s,t)=>{if(window.confirm(`√ätes-vous s√ªr de vouloir supprimer l'administrateur : ${t} ?`)){l(!0),a(""),n("");try{console.log("üóëÔ∏è  Attempting to delete admin:",{adminId:s,adminEmail:t});const r=await K(s);if(console.log("Delete admin response:",r.data),r.data&&r.data.success)n("Administrateur supprim√© avec succ√®s!"),await c(),setTimeout(()=>n(""),3e3);else{const d=r.data?.error||"√âchec de la suppression de l'administrateur";a(d),console.error("Failed to delete admin:",r.data)}}catch(r){console.error("Error deleting admin:",r);const d=r?.response?.data?.error||r?.message||"√âchec de la suppression de l'administrateur. Veuillez r√©essayer.";a(d),r?.response?.data&&console.error("Error response data:",r.response.data),r?.response?.status&&console.error("Error status:",r.response.status)}finally{l(!1)}}},G=s=>{$(s.id);const t=(s.name||s.fullname||"").split(" ");v(t[0]||""),y(t.slice(1).join(" ")||""),w(s.email||""),I(""),M(s.role||"ADMIN"),k(s.status==="ACTIVE"||s.is_active===!0),a(""),n("")},R=()=>{$(null),v(""),y(""),w(""),I(""),M("ADMIN"),k(!0),a(""),n("")},Q=async s=>{if(s.preventDefault(),!!N){l(!0),a(""),n("");try{const t={};(j.trim()||A.trim())&&(t.name=`${j} ${A}`.trim()),E.trim()&&(t.email=E.trim()),C.trim()&&(t.password=C.trim()),S&&(t.role=S),t.status=q?"ACTIVE":"INACTIVE",console.log("Update payload:",t);const r=await _(N,t);console.log("Update admin response:",r.data),r.data&&r.data.success?(n("Administrateur mis √† jour avec succ√®s!"),R(),await c()):a("√âchec de la mise √† jour de l'administrateur")}catch(t){console.error("Error updating admin:",t),a(t?.response?.data?.error||"√âchec de la mise √† jour de l'administrateur")}finally{l(!1)}}},H=async(s,t)=>{l(!0),a(""),n("");try{const r={status:t};console.log("Quick status update payload:",r);const d=await _(s,r);console.log("Quick status update response:",d.data),d.data&&d.data.success?(n(`Statut mis √† jour : ${t==="ACTIVE"?"Actif":"Inactif"}`),setTimeout(()=>n(""),3e3),await c()):a("√âchec de la mise √† jour du statut")}catch(r){console.error("Error updating admin status:",r),a(r?.response?.data?.error||"√âchec de la mise √† jour du statut"),setTimeout(()=>a(""),5e3)}finally{l(!1)}};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Gestion des Administrateurs"}),e.jsx("div",{className:"flex items-center space-x-4",children:e.jsx("div",{className:"text-sm text-gray-500",children:"G√©rer les administrateurs syst√®me"})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Ajouter un Nouvel Administrateur"}),e.jsxs("form",{onSubmit:U,className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4",autoComplete:"off",children:[e.jsx("input",{className:"border p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Pr√©nom",value:m,onChange:s=>T(s.target.value),required:!0,autoComplete:"off"}),e.jsx("input",{className:"border p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Nom de Famille",value:p,onChange:s=>L(s.target.value),required:!0,autoComplete:"off"}),e.jsx("input",{className:"border p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Email",type:"email",value:g,onChange:s=>F(s.target.value),required:!0,autoComplete:"off"}),e.jsx("input",{className:"border p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Mot de passe",type:"password",value:h,onChange:s=>P(s.target.value),required:!0,minLength:6,autoComplete:"new-password"}),e.jsxs("select",{className:"border p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:b,onChange:s=>V(s.target.value),children:[e.jsx("option",{value:"ADMIN",children:"Administrateur"}),e.jsx("option",{value:"SUPER_ADMIN",children:"Super Administrateur"})]}),e.jsx("button",{disabled:i,className:"bg-blue-600 hover:bg-blue-700 text-white rounded-lg p-3 transition-colors disabled:opacity-50",children:i?"Ajout...":"Ajouter Admin"})]}),f&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-red-600",children:f})}),x&&e.jsx("div",{className:"mt-4 p-3 bg-green-50 border border-green-200 rounded-lg",children:e.jsx("p",{className:"text-green-600",children:x})})]}),e.jsxs("div",{className:"bg-white rounded-lg border shadow-sm overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b bg-gray-50",children:e.jsx("h2",{className:"text-lg font-semibold",children:"Liste des Administrateurs"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left border-b bg-gray-50",children:[e.jsx("th",{className:"p-4 font-medium",children:"Nom"}),e.jsx("th",{className:"p-4 font-medium",children:"Email"}),e.jsx("th",{className:"p-4 font-medium",children:"R√¥le"}),e.jsx("th",{className:"p-4 font-medium",children:"Statut"}),e.jsx("th",{className:"p-4 font-medium",children:"Cr√©√©"}),e.jsx("th",{className:"p-4 font-medium",children:"Actions"})]})}),e.jsxs("tbody",{children:[D.map(s=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-4",children:s.name||s.fullname}),e.jsx("td",{className:"p-4",children:s.email}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${s.role==="SUPER_ADMIN"?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"}`,children:s.role==="SUPER_ADMIN"?"Super Admin":"Administrateur"})}),e.jsx("td",{className:"p-4",children:e.jsxs("select",{value:s.status==="ACTIVE"||s.is_active===!0?"ACTIVE":"INACTIVE",onChange:t=>H(s.id,t.target.value),disabled:i,className:`px-3 py-1.5 rounded text-xs font-medium border-0 cursor-pointer transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 ${s.status==="ACTIVE"||s.is_active===!0?"bg-green-100 text-green-800 hover:bg-green-200":"bg-red-100 text-red-800 hover:bg-red-200"} ${i?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("option",{value:"ACTIVE",children:"Actif"}),e.jsx("option",{value:"INACTIVE",children:"Inactif"})]})}),e.jsx("td",{className:"p-4 text-sm text-gray-600",children:s.created_at?new Date(s.created_at).toLocaleDateString():"N/A"}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>G(s),className:"text-blue-600 hover:text-blue-800 text-sm font-medium",disabled:i,children:"Modifier"}),e.jsx("button",{onClick:()=>z(s.id,s.email),className:"text-red-600 hover:text-red-800 text-sm font-medium",disabled:i,children:"Supprimer"})]})})]},s.id)),D.length===0&&e.jsx("tr",{children:e.jsx("td",{className:"p-8 text-center text-gray-500",colSpan:6,children:"Aucun administrateur trouv√©. Ajoutez votre premier administrateur ci-dessus."})})]})]})})]}),N!==null&&e.jsxs("div",{className:"bg-white p-6 rounded-lg border shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Modifier l'Administrateur"}),e.jsxs("form",{onSubmit:Q,className:"space-y-4",autoComplete:"off",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pr√©nom"}),e.jsx("input",{className:"w-full border p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Pr√©nom",value:j,onChange:s=>v(s.target.value),required:!0,autoComplete:"off"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nom de Famille"}),e.jsx("input",{className:"w-full border p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Nom de Famille",value:A,onChange:s=>y(s.target.value),required:!0,autoComplete:"off"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{className:"w-full border p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Email",type:"email",value:E,onChange:s=>w(s.target.value),autoComplete:"off"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nouveau Mot de passe (optionnel)"}),e.jsx("input",{className:"w-full border p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Laisser vide pour conserver le mot de passe actuel",type:"password",value:C,onChange:s=>I(s.target.value),autoComplete:"new-password"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"R√¥le"}),e.jsxs("select",{className:"w-full border p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:S,onChange:s=>M(s.target.value),children:[e.jsx("option",{value:"ADMIN",children:"Administrateur"}),e.jsx("option",{value:"SUPER_ADMIN",children:"Super Administrateur"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"editIsActive",checked:q,onChange:s=>k(s.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("label",{htmlFor:"editIsActive",className:"text-sm font-medium text-gray-700",children:"Compte Actif"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"submit",disabled:i,className:"bg-green-600 hover:bg-green-700 text-white rounded-lg px-6 py-2 transition-colors disabled:opacity-50",children:i?"Enregistrement...":"Enregistrer les Modifications"}),e.jsx("button",{type:"button",onClick:R,className:"bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-lg px-6 py-2 transition-colors",children:"Annuler"})]}),f&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-red-600",children:f})}),x&&e.jsx("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:e.jsx("p",{className:"text-green-600",children:x})})]})]})]})};export{te as default};

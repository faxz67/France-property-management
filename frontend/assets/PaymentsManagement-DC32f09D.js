import{j as e}from"./index-rAghrxu1.js";import{r as y}from"./router-DUq0sin2.js";import E from"./api-XfUXylTc.js";import{d as I}from"./Dashboard-C2yiMU_o.js";/* empty css                            */import{R as Te,p as J,v as pe,x as W,y as V,D as he,z as U,A as Ae,U as Se,H as Ie,a as Re,G as z,u as ke}from"./icons-B-WyEUkg.js";import"./vendor-Bzgz95E1.js";import"./utils-B9HHbEsj.js";import"./charts-DdKZH6bc.js";const ze=()=>{const[f,_]=y.useState([]),[R,T]=y.useState(null),[k,B]=y.useState(!0),[X,x]=y.useState(null),[ge,q]=y.useState(!1),[m,M]=y.useState(null),[N,$]=y.useState(null),[L,Y]=y.useState(null),[ee,te]=y.useState(null),[v,G]=y.useState([]),[F,ye]=y.useState({status:"",search:"",page:1,limit:10}),[Be]=y.useState({total:0,page:1,limit:10,totalPages:0}),[w,j]=y.useState(()=>{const t=I.getNewBillDefaults();return{tenant_id:0,property_id:0,amount:0,month:t.month,due_date:t.due_date,description:t.description}}),[H,b]=y.useState([]),[O,D]=y.useState([]),[fe,ae]=y.useState(!1),[xe,se]=y.useState(!1),[_e,re]=y.useState(!1),[Z,oe]=y.useState(!1);y.useEffect(()=>{Ne()},[F]),y.useEffect(()=>{if(f.length>0){console.log("ðŸ”„ Recalculating stats from bills...");const t=new Date;t.setHours(0,0,0,0);let s=0,r=0,n=0,o=0,i=0,d=0,p=0;f.forEach(h=>{const c=h.total_amount||h.amount||0;s+=c;const a=new Date(h.due_date);a.setHours(0,0,0,0);const l=a<t&&h.status!=="PAID";h.status==="PAID"?(p++,o+=c):h.status==="PENDING"?(r++,i+=c,l&&(n++,d+=c)):(h.status==="OVERDUE"||l)&&(n++,d+=c,r++,i+=c)});const u={totalBills:f.length,totalAmount:s,pendingBills:r,overdueBills:n,statusBreakdown:[{status:"PAID",count:p,total_amount:o},{status:"PENDING",count:r,total_amount:i},{status:"OVERDUE",count:n,total_amount:d}]};T(u),console.log("âœ… Stats updated:",u)}},[f]);const Ne=async()=>{console.log("ðŸš€ Loading initial data...");try{const t=localStorage.getItem("token");if(!t){console.log("âŒ No token, using mock data"),Q();return}(await fetch("http://192.168.1.109:4002/api/bills",{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}})).ok?(console.log("âœ… Server is available, loading real data"),await A(),await P(),await ne(),await ie()):(console.log("âŒ Server not available, using mock data"),Q())}catch{console.log("âŒ Server connectivity test failed, using mock data"),Q()}},Q=()=>{console.log("ðŸ”„ Loading mock data...");const t=[{id:1,tenant_id:1,property_id:1,admin_id:3,amount:1e3,rent_amount:1e3,charges:0,total_amount:1e3,month:"2025-01",bill_date:"2025-01-01",due_date:"2025-01-15",payment_date:void 0,status:"PENDING",description:"Paiement de loyer mensuel",created_at:"2025-01-01T00:00:00Z",updated_at:"2025-01-01T00:00:00Z",tenant:{id:1,name:"Mohamed FaisalPortfolio Faisal",email:"faisal786mf7@gmail.com",phone:"+1234567890"},property:{id:1,title:"Test Property 1",address:"123 Test Street",city:"Paris"},created_at_fr:"01/01/2025",due_date_fr:"15/01/2025",payment_date_fr:void 0,amount_formatted:"1 000,00 â‚¬",rent_amount_formatted:"1 000,00 â‚¬",charges_formatted:"0,00 â‚¬",total_amount_formatted:"1 000,00 â‚¬",is_overdue:!1,days_until_due:14,status_fr:"En attente",priority:"low",tenant_display_name:"Mohamed FaisalPortfolio Faisal",property_display_name:"Test Property 1"},{id:2,tenant_id:2,property_id:2,admin_id:4,amount:1200,rent_amount:1200,charges:0,total_amount:1200,month:"2025-01",bill_date:"2025-01-01",due_date:"2025-01-10",payment_date:"2025-01-05",status:"PAID",description:"Paiement de loyer mensuel",created_at:"2025-01-01T00:00:00Z",updated_at:"2025-01-05T00:00:00Z",tenant:{id:2,name:"Mohamed Faisal",email:"faisal786mf7@gmail.com",phone:"+1234567890"},property:{id:2,title:"Test Property 2",address:"456 Test Avenue",city:"Lyon"},created_at_fr:"01/01/2025",due_date_fr:"10/01/2025",payment_date_fr:"05/01/2025",amount_formatted:"1 200,00 â‚¬",rent_amount_formatted:"1 200,00 â‚¬",charges_formatted:"0,00 â‚¬",total_amount_formatted:"1 200,00 â‚¬",is_overdue:!1,days_until_due:-5,status_fr:"PayÃ©",priority:"low",tenant_display_name:"Mohamed Faisal",property_display_name:"Test Property 2"},{id:3,tenant_id:3,property_id:3,admin_id:1,amount:800,rent_amount:800,charges:0,total_amount:800,month:"2024-12",bill_date:"2024-12-01",due_date:"2024-12-15",payment_date:void 0,status:"OVERDUE",description:"Paiement de loyer mensuel",created_at:"2024-12-01T00:00:00Z",updated_at:"2024-12-01T00:00:00Z",tenant:{id:3,name:"Locataire Admin 1",email:"locataire.admin1@test.com",phone:"+1234567890"},property:{id:3,title:"Test Property 3",address:"789 Test Boulevard",city:"Marseille"},created_at_fr:"01/12/2024",due_date_fr:"15/12/2024",payment_date_fr:void 0,amount_formatted:"800,00 â‚¬",rent_amount_formatted:"800,00 â‚¬",charges_formatted:"0,00 â‚¬",total_amount_formatted:"800,00 â‚¬",is_overdue:!0,days_until_due:-17,status_fr:"En retard",priority:"critical",tenant_display_name:"Locataire Admin 1",property_display_name:"Test Property 3"}],s={totalBills:3,totalAmount:3e3,pendingBills:1,overdueBills:1,statusBreakdown:[{status:"PAID",count:1,total_amount:1200},{status:"PENDING",count:1,total_amount:1e3},{status:"OVERDUE",count:1,total_amount:800}]},r=[{id:1,name:"Mohamed FaisalPortfolio Faisal",email:"faisal786mf7@gmail.com",phone:"+1234567890",admin_id:3,property_id:1,status:"ACTIVE",rent_amount:1e3,display_name:"Mohamed FaisalPortfolio Faisal (faisal786mf7@gmail.com)",property:{id:1,title:"Test Property 1",address:"123 Test Street",monthly_rent:1e3},admin:{id:3,name:"Mohamed Faisal",email:"faisal@property.com"}},{id:2,name:"Mohamed Faisal",email:"faisal786mf7@gmail.com",phone:"+1234567890",admin_id:4,property_id:2,status:"ACTIVE",rent_amount:1200,display_name:"Mohamed Faisal (faisal786mf7@gmail.com)",property:{id:2,title:"Test Property 2",address:"456 Test Avenue",monthly_rent:1200},admin:{id:4,name:"Mohamed Rahim",email:"rahim@property.com"}},{id:3,name:"Locataire Admin 1",email:"locataire.admin1@test.com",phone:"+1234567890",admin_id:1,property_id:3,status:"ACTIVE",rent_amount:800,display_name:"Locataire Admin 1 (locataire.admin1@test.com)",property:{id:3,title:"Test Property 3",address:"789 Test Boulevard",monthly_rent:800},admin:{id:1,name:"Default Admin",email:"admin@example.com"}}],n=[{id:1,title:"Test Property 1",address:"123 Test Street",monthly_rent:1e3,admin_id:3,display_name:"Test Property 1 - 123 Test Street"},{id:2,title:"Test Property 2",address:"456 Test Avenue",monthly_rent:1200,admin_id:4,display_name:"Test Property 2 - 456 Test Avenue"},{id:3,title:"Test Property 3",address:"789 Test Boulevard",monthly_rent:800,admin_id:1,display_name:"Test Property 3 - 789 Test Boulevard"}];_(t),T(s),b(r),D(n),B(!1),x(""),console.log("ðŸ“Š Mock data loaded successfully:",{bills:t.length,stats:s,tenants:r.length,properties:n.length})},A=async(t=!1)=>{try{t||B(!0),x(""),console.log("ðŸ” Fetching bills with filters:",F),I.clearCache();const s=localStorage.getItem("token");if(console.log("ðŸ”‘ Token exists:",!!s),!s){console.error("âŒ No authentication token found"),x("Token d'authentification manquant"),_([]);return}const r=await E.listBills(F);if(console.log("ðŸ“¡ Bills API Response:",r.data),r.data?.success&&r.data?.data?.bills){const n=r.data.data.bills;console.log("ðŸ“‹ Raw bills from API:",n.length);const o=n.map(i=>{const d=i.payment_date?new Date(i.payment_date):null,p=new Date(i.due_date),u=new Date;u.setHours(0,0,0,0),p.setHours(0,0,0,0);const h=p<u,c=Math.ceil((p.getTime()-u.getTime())/(1e3*60*60*24));return{...i,created_at_fr:new Date(i.created_at).toLocaleDateString("fr-FR"),due_date_fr:p.toLocaleDateString("fr-FR"),payment_date_fr:d?d.toLocaleDateString("fr-FR"):null,amount_formatted:new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(i.amount||i.total_amount||0),rent_amount_formatted:i.rent_amount?new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(i.rent_amount):null,charges_formatted:i.charges?new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(i.charges):null,total_amount_formatted:new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(i.total_amount||i.amount||0),is_overdue:h,days_until_due:c,status_fr:i.status==="PENDING"?"En attente":i.status==="PAID"?"PayÃ©":i.status==="OVERDUE"?"En retard":i.status==="RECEIPT_SENT"?"ReÃ§u envoyÃ©":i.status,priority:i.status==="PAID"?"low":h?"critical":c<=3?"high":c<=7?"medium":"low",tenant_display_name:i.tenant?.name||i.tenant?.fullName||"Locataire",property_display_name:i.property?.title||i.property?.name||"PropriÃ©tÃ©"}});return console.log("âœ… Bills processed with French formatting:",o.length,"bills"),_(o),o}else return console.log("âŒ Invalid bills response structure:",r.data),_([]),[]}catch(s){console.error("âŒ Error fetching bills:",s),console.log("ðŸ”„ Using mock bills due to API error...");const r=[{id:1,tenant_id:1,property_id:1,admin_id:3,amount:1e3,rent_amount:1e3,charges:0,total_amount:1e3,month:"2025-01",bill_date:"2025-01-01",due_date:"2025-01-15",payment_date:void 0,status:"PENDING",description:"Paiement de loyer mensuel",created_at:"2025-01-01T00:00:00Z",updated_at:"2025-01-01T00:00:00Z",tenant:{id:1,name:"Mohamed FaisalPortfolio Faisal",email:"faisal786mf7@gmail.com",phone:"+1234567890"},property:{id:1,title:"Test Property 1",address:"123 Test Street",city:"Paris"},created_at_fr:"01/01/2025",due_date_fr:"15/01/2025",payment_date_fr:void 0,amount_formatted:"1 000,00 â‚¬",rent_amount_formatted:"1 000,00 â‚¬",charges_formatted:"0,00 â‚¬",total_amount_formatted:"1 000,00 â‚¬",is_overdue:!1,days_until_due:14,status_fr:"En attente",priority:"low",tenant_display_name:"Mohamed FaisalPortfolio Faisal",property_display_name:"Test Property 1"},{id:2,tenant_id:2,property_id:2,admin_id:4,amount:1200,rent_amount:1200,charges:0,total_amount:1200,month:"2025-01",bill_date:"2025-01-01",due_date:"2025-01-10",payment_date:"2025-01-05",status:"PAID",description:"Paiement de loyer mensuel",created_at:"2025-01-01T00:00:00Z",updated_at:"2025-01-05T00:00:00Z",tenant:{id:2,name:"Mohamed Faisal",email:"faisal786mf7@gmail.com",phone:"+1234567890"},property:{id:2,title:"Test Property 2",address:"456 Test Avenue",city:"Lyon"},created_at_fr:"01/01/2025",due_date_fr:"10/01/2025",payment_date_fr:"05/01/2025",amount_formatted:"1 200,00 â‚¬",rent_amount_formatted:"1 200,00 â‚¬",charges_formatted:"0,00 â‚¬",total_amount_formatted:"1 200,00 â‚¬",is_overdue:!1,days_until_due:-5,status_fr:"PayÃ©",priority:"low",tenant_display_name:"Mohamed Faisal",property_display_name:"Test Property 2"},{id:3,tenant_id:3,property_id:3,admin_id:1,amount:800,rent_amount:800,charges:0,total_amount:800,month:"2024-12",bill_date:"2024-12-01",due_date:"2024-12-15",payment_date:void 0,status:"OVERDUE",description:"Paiement de loyer mensuel",created_at:"2024-12-01T00:00:00Z",updated_at:"2024-12-01T00:00:00Z",tenant:{id:3,name:"Locataire Admin 1",email:"locataire.admin1@test.com",phone:"+1234567890"},property:{id:3,title:"Test Property 3",address:"789 Test Boulevard",city:"Marseille"},created_at_fr:"01/12/2024",due_date_fr:"15/12/2024",payment_date_fr:void 0,amount_formatted:"800,00 â‚¬",rent_amount_formatted:"800,00 â‚¬",charges_formatted:"0,00 â‚¬",total_amount_formatted:"800,00 â‚¬",is_overdue:!0,days_until_due:-17,status_fr:"En retard",priority:"critical",tenant_display_name:"Locataire Admin 1",property_display_name:"Test Property 3"}];return _(r),console.log("ðŸ“Š Mock bills loaded:",r.length,"bills"),x(""),await P(),r}finally{t||B(!1)}},ve=async t=>{try{if(!window.confirm("Supprimer cette facture ? Cette action est irrÃ©versible."))return;te(t),x("");const r=await E.deleteBill(t);r?.data?.success?(_(n=>n.filter(o=>o.id!==t)),await P()):x(r?.data?.message||"Ã‰chec de la suppression de la facture")}catch(s){x(s?.userMessage||s?.message||"Erreur lors de la suppression")}finally{te(null)}},P=async()=>{try{I.clearCache();const t=await E.getBillsStats();if(t.data?.success&&t.data?.data){const s=t.data.data;console.log("ðŸ“Š Raw stats from API:",s);const r={totalBills:s.totalBills||s.total||0,totalAmount:s.totalAmount||s.total_amount||0,pendingBills:s.pendingBills||s.pending||0,overdueBills:s.overdueBills||s.overdue||0,statusBreakdown:[{status:"PAID",count:s.paid||0,total_amount:s.paid_amount||0},{status:"PENDING",count:s.pendingBills||s.pending||0,total_amount:s.pending_amount||0},{status:"OVERDUE",count:s.overdueBills||s.overdue||0,total_amount:s.overdue_amount||0}]};T(r),console.log("âœ… Stats loaded from API:",r)}}catch(t){console.error("âŒ Failed to fetch stats from API:",t),console.log("ðŸ”„ Calculating stats from loaded bills...");let s=f.length>0?f:[];if(s.length===0){const n=await A();s=Array.isArray(n)?n:[]}let r;if(s.length>0){const n=new Date;n.setHours(0,0,0,0);let o=0,i=0,d=0,p=0,u=0,h=0;s.forEach(c=>{const a=c.total_amount||c.amount||0;o+=a;const l=new Date(c.due_date);l.setHours(0,0,0,0);const g=l<n&&c.status!=="PAID";c.status==="PAID"?p+=a:c.status==="PENDING"?(i++,u+=a,g&&(d++,h+=a)):(c.status==="OVERDUE"||g)&&(d++,h+=a,i++,u+=a)}),r={totalBills:s.length,totalAmount:o,pendingBills:i,overdueBills:d,statusBreakdown:[{status:"PAID",count:s.filter(c=>c.status==="PAID").length,total_amount:p},{status:"PENDING",count:i,total_amount:u},{status:"OVERDUE",count:d,total_amount:h}]}}else r={totalBills:3,totalAmount:3e3,pendingBills:2,overdueBills:1,statusBreakdown:[{status:"PAID",count:0,total_amount:0},{status:"PENDING",count:2,total_amount:2e3},{status:"OVERDUE",count:1,total_amount:1e3}]};T(r),console.log("ðŸ“Š Stats calculated from bills:",r)}},ne=async()=>{try{if(I.clearCache(),!localStorage.getItem("token")){console.error("âŒ No authentication token found for tenants fetch"),b([]);return}console.log("ðŸ” Fetching tenants from database...");const s=await E.listTenants();console.log("ðŸ” Tenants API Response:",s),console.log("ðŸ” Response status:",s.status),console.log("ðŸ” Response data:",s.data);let r=[];if(s.data?.success&&s.data?.data)r=s.data.data,console.log("ðŸ“‹ Using response.data.data structure");else if(s.data&&Array.isArray(s.data))r=s.data,console.log("ðŸ“‹ Using direct array structure");else if(s.data?.tenants)r=s.data.tenants,console.log("ðŸ“‹ Using response.data.tenants structure");else if(s.data?.results)r=s.data.results,console.log("ðŸ“‹ Using response.data.results structure");else{console.log("âŒ Unknown response structure:",s.data),console.log("âŒ Available keys:",Object.keys(s.data||{})),b([]);return}if(Array.isArray(r)&&r.length>0){console.log("ðŸ“‹ Raw tenants from API:",r.length,"tenants"),console.log("ðŸ“‹ Raw tenants structure:",r);const n=r.map(o=>(console.log("ðŸ”„ Processing tenant:",o),{...o,created_at_fr:o.created_at?new Date(o.created_at).toLocaleDateString("fr-FR"):"N/A",display_name:o.name||o.fullName||(o.firstName&&o.lastName?`${o.firstName} ${o.lastName}`:null)||`Locataire ${o.id}`,property_display_name:o.property?.title||o.property?.name||"PropriÃ©tÃ©"}));b(n),console.log("âœ… Tenants processed with French formatting:",n.length,"tenants"),console.log("ðŸ“ Tenant names for dropdown:",n.map(o=>({id:o.id,name:o.name,fullName:o.fullName,firstName:o.firstName,lastName:o.lastName,display_name:o.display_name})))}else console.log("âŒ No tenants found or invalid data structure"),console.log("âŒ Raw tenants:",r),b([])}catch(t){console.error("âŒ Failed to fetch tenants:",t),console.error("âŒ Error details:",{message:t.message,status:t.response?.status,data:t.response?.data}),b([])}},ie=async()=>{try{if(I.clearCache(),!localStorage.getItem("token")){console.error("âŒ No authentication token found for properties fetch"),D([]);return}console.log("ðŸ” Fetching properties from database...");const s=await E.listProperties();console.log("ðŸ” Properties API Response:",s),console.log("ðŸ” Response status:",s.status),console.log("ðŸ” Response data:",s.data);let r=[];if(s.data?.success&&s.data?.data)r=s.data.data,console.log("ðŸ“‹ Using response.data.data structure");else if(s.data&&Array.isArray(s.data))r=s.data,console.log("ðŸ“‹ Using direct array structure");else if(s.data?.properties)r=s.data.properties,console.log("ðŸ“‹ Using response.data.properties structure");else if(s.data?.results)r=s.data.results,console.log("ðŸ“‹ Using response.data.results structure");else{console.log("âŒ Unknown response structure:",s.data),console.log("âŒ Available keys:",Object.keys(s.data||{})),D([]);return}if(Array.isArray(r)&&r.length>0){console.log("ðŸ“‹ Raw properties from API:",r.length,"properties"),console.log("ðŸ“‹ Raw properties structure:",r);const n=r.map(o=>(console.log("ðŸ”„ Processing property:",o),{...o,created_at_fr:o.created_at?new Date(o.created_at).toLocaleDateString("fr-FR"):"N/A",display_name:o.title||o.name||o.propertyName||`PropriÃ©tÃ© ${o.id}`,rent_formatted:o.rent?new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(o.rent):null}));D(n),console.log("âœ… Properties processed with French formatting:",n.length,"properties"),console.log("ðŸ“ Property titles for dropdown:",n.map(o=>({id:o.id,title:o.title,name:o.name,propertyName:o.propertyName,display_name:o.display_name})))}else console.log("âŒ No properties found or invalid data structure"),console.log("âŒ Raw properties:",r),D([])}catch(t){console.error("âŒ Failed to fetch properties:",t),console.error("âŒ Error details:",{message:t.message,status:t.response?.status,data:t.response?.data}),D([])}},we=async()=>{try{console.log("ðŸš€ [SENIOR DEV] Loading data for create bill with advanced diagnostics...");const t=localStorage.getItem("token");if(!t)return console.error("âŒ [SENIOR DEV] No authentication token"),alert("âŒ Vous devez Ãªtre connectÃ© pour crÃ©er une facture"),{tenants:[],properties:[]};try{const a=JSON.parse(atob(t.split(".")[1]));console.log("ðŸ” [SENIOR DEV] Token payload:",a),console.log("ðŸ‘¤ [SENIOR DEV] Admin ID:",a.id),console.log("ðŸ‘¤ [SENIOR DEV] Admin Role:",a.role)}catch{console.warn("âš ï¸ [SENIOR DEV] Could not decode token payload")}const s="http://192.168.1.109:4002/api";console.log("ðŸŒ [SENIOR DEV] API Base URL:",s),console.log("ðŸ§ª [SENIOR DEV] Testing API connectivity...");const r=await fetch(`${s}/tenants`,{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(console.log("ðŸ§ª [SENIOR DEV] Connectivity test status:",r.status),console.log("ðŸ§ª [SENIOR DEV] Connectivity test headers:",Object.fromEntries(r.headers.entries())),!r.ok){const a=await r.text();console.error("âŒ [SENIOR DEV] API connectivity failed:",r.status,a),console.log("ðŸ”„ [SENIOR DEV] Server not available, using mock data...");const l=[{id:1,name:"Mohamed FaisalPortfolio Faisal",email:"faisal786mf7@gmail.com",phone:"+1234567890",admin_id:3,property_id:1,status:"ACTIVE",rent_amount:1e3,display_name:"Mohamed FaisalPortfolio Faisal (faisal786mf7@gmail.com)",property:{id:1,title:"Test Property 1",address:"123 Test Street",monthly_rent:1e3},admin:{id:3,name:"Mohamed Faisal",email:"faisal@property.com"}},{id:2,name:"Mohamed Faisal",email:"faisal786mf7@gmail.com",phone:"+1234567890",admin_id:4,property_id:2,status:"ACTIVE",rent_amount:1200,display_name:"Mohamed Faisal (faisal786mf7@gmail.com)",property:{id:2,title:"Test Property 2",address:"456 Test Avenue",monthly_rent:1200},admin:{id:4,name:"Mohamed Rahim",email:"rahim@property.com"}},{id:3,name:"Locataire Admin 1",email:"locataire.admin1@test.com",phone:"+1234567890",admin_id:1,property_id:3,status:"ACTIVE",rent_amount:800,display_name:"Locataire Admin 1 (locataire.admin1@test.com)",property:{id:3,title:"Test Property 3",address:"789 Test Boulevard",monthly_rent:800},admin:{id:1,name:"Default Admin",email:"admin@example.com"}}],g=[{id:1,title:"Test Property 1",address:"123 Test Street",monthly_rent:1e3,admin_id:3,display_name:"Test Property 1 - 123 Test Street"},{id:2,title:"Test Property 2",address:"456 Test Avenue",monthly_rent:1200,admin_id:4,display_name:"Test Property 2 - 456 Test Avenue"},{id:3,title:"Test Property 3",address:"789 Test Boulevard",monthly_rent:800,admin_id:1,display_name:"Test Property 3 - 789 Test Boulevard"}];return console.log("ðŸ“Š [SENIOR DEV] Mock data loaded:",{tenants:l.length,properties:g.length}),{tenants:l,properties:g}}console.log("ðŸ‘¥ [SENIOR DEV] Fetching tenants with detailed diagnostics...");let n,o=`${s}/bills/create-data/tenants`;try{n=await fetch(o,{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}),console.log("ðŸ‘¥ [SENIOR DEV] Bill creation tenants endpoint status:",n.status),n.status===403&&(console.log("ðŸ‘¥ [SENIOR DEV] 403 error, trying fallback endpoint..."),o=`${s}/tenants`,n=await fetch(o,{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}),console.log("ðŸ‘¥ [SENIOR DEV] Fallback tenants endpoint status:",n.status))}catch(a){console.error("ðŸ‘¥ [SENIOR DEV] Error fetching tenants:",a),n={ok:!1,status:500}}console.log("ðŸ‘¥ [SENIOR DEV] Tenants response status:",n.status),console.log("ðŸ‘¥ [SENIOR DEV] Tenants response headers:",n.headers?Object.fromEntries(n.headers.entries()):"No headers");let i=[];if(n.ok&&"json"in n){const a=await n.json();if(console.log("ðŸ‘¥ [SENIOR DEV] Raw tenants response:",a),console.log("ðŸ‘¥ [SENIOR DEV] Tenants data type:",typeof a),console.log("ðŸ‘¥ [SENIOR DEV] Tenants data keys:",Object.keys(a||{})),a.success&&Array.isArray(a.data))i=a.data,console.log("ðŸ‘¥ [SENIOR DEV] Using tenantsData.data structure");else if(Array.isArray(a))i=a,console.log("ðŸ‘¥ [SENIOR DEV] Using direct array structure");else if(a.tenants&&Array.isArray(a.tenants))i=a.tenants,console.log("ðŸ‘¥ [SENIOR DEV] Using tenantsData.tenants structure");else if(a.results&&Array.isArray(a.results))i=a.results,console.log("ðŸ‘¥ [SENIOR DEV] Using tenantsData.results structure");else{console.log("ðŸ‘¥ [SENIOR DEV] Unknown structure, searching for arrays...");for(const[l,g]of Object.entries(a))if(Array.isArray(g)){console.log(`ðŸ‘¥ [SENIOR DEV] Found array in key '${l}' with ${g.length} items`),i=g;break}}console.log("ðŸ‘¥ [SENIOR DEV] Extracted tenants count:",i.length),i.length>0&&console.log("ðŸ‘¥ [SENIOR DEV] Sample tenant:",i[0])}else{const a="text"in n?await n.text():"Unknown error";console.error("âŒ [SENIOR DEV] Failed to fetch tenants:",n.status,a),console.log("ðŸ”„ [SENIOR DEV] Using mock tenants as fallback..."),i=[{id:1,name:"Mohamed FaisalPortfolio Faisal",email:"faisal786mf7@gmail.com",phone:"+1234567890",admin_id:3,property_id:1,status:"ACTIVE",rent_amount:1e3,display_name:"Mohamed FaisalPortfolio Faisal (faisal786mf7@gmail.com)",property:{id:1,title:"Test Property 1",address:"123 Test Street",monthly_rent:1e3},admin:{id:3,name:"Mohamed Faisal",email:"faisal@property.com"}},{id:2,name:"Mohamed Faisal",email:"faisal786mf7@gmail.com",phone:"+1234567890",admin_id:4,property_id:2,status:"ACTIVE",rent_amount:1200,display_name:"Mohamed Faisal (faisal786mf7@gmail.com)",property:{id:2,title:"Test Property 2",address:"456 Test Avenue",monthly_rent:1200},admin:{id:4,name:"Mohamed Rahim",email:"rahim@property.com"}},{id:3,name:"Locataire Admin 1",email:"locataire.admin1@test.com",phone:"+1234567890",admin_id:1,property_id:3,status:"ACTIVE",rent_amount:800,display_name:"Locataire Admin 1 (locataire.admin1@test.com)",property:{id:3,title:"Test Property 3",address:"789 Test Boulevard",monthly_rent:800},admin:{id:1,name:"Default Admin",email:"admin@example.com"}}]}console.log("ðŸ  [SENIOR DEV] Fetching properties with detailed diagnostics...");let d,p=`${s}/bills/create-data/properties`;try{d=await fetch(p,{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}),console.log("ðŸ  [SENIOR DEV] Bill creation properties endpoint status:",d.status),d.status===403&&(console.log("ðŸ  [SENIOR DEV] 403 error, trying fallback endpoint..."),p=`${s}/properties`,d=await fetch(p,{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}),console.log("ðŸ  [SENIOR DEV] Fallback properties endpoint status:",d.status))}catch(a){console.error("ðŸ  [SENIOR DEV] Error fetching properties:",a),d={ok:!1,status:500}}console.log("ðŸ  [SENIOR DEV] Properties response status:",d.status),console.log("ðŸ  [SENIOR DEV] Properties response headers:",d.headers?Object.fromEntries(d.headers.entries()):"No headers");let u=[];if(d.ok&&"json"in d){const a=await d.json();if(console.log("ðŸ  [SENIOR DEV] Raw properties response:",a),console.log("ðŸ  [SENIOR DEV] Properties data type:",typeof a),console.log("ðŸ  [SENIOR DEV] Properties data keys:",Object.keys(a||{})),a.success&&Array.isArray(a.data))u=a.data,console.log("ðŸ  [SENIOR DEV] Using propertiesData.data structure");else if(Array.isArray(a))u=a,console.log("ðŸ  [SENIOR DEV] Using direct array structure");else if(a.properties&&Array.isArray(a.properties))u=a.properties,console.log("ðŸ  [SENIOR DEV] Using propertiesData.properties structure");else if(a.results&&Array.isArray(a.results))u=a.results,console.log("ðŸ  [SENIOR DEV] Using propertiesData.results structure");else{console.log("ðŸ  [SENIOR DEV] Unknown structure, searching for arrays...");for(const[l,g]of Object.entries(a))if(Array.isArray(g)){console.log(`ðŸ  [SENIOR DEV] Found array in key '${l}' with ${g.length} items`),u=g;break}}console.log("ðŸ  [SENIOR DEV] Extracted properties count:",u.length),u.length>0&&console.log("ðŸ  [SENIOR DEV] Sample property:",u[0])}else{const a="text"in d?await d.text():"Unknown error";console.error("âŒ [SENIOR DEV] Failed to fetch properties:",d.status,a),console.log("ðŸ”„ [SENIOR DEV] Using mock properties as fallback..."),u=[{id:1,title:"Test Property 1",address:"123 Test Street",monthly_rent:1e3,admin_id:3,display_name:"Test Property 1 - 123 Test Street"},{id:2,title:"Test Property 2",address:"456 Test Avenue",monthly_rent:1200,admin_id:4,display_name:"Test Property 2 - 456 Test Avenue"},{id:3,title:"Test Property 3",address:"789 Test Boulevard",monthly_rent:800,admin_id:1,display_name:"Test Property 3 - 789 Test Boulevard"}]}const h=i.map((a,l)=>{try{return{id:a.id,name:a.name||a.fullName||`${a.firstName||""} ${a.lastName||""}`.trim()||`Locataire ${a.id}`,email:a.email||"",phone:a.phone||"",display_name:a.name||a.fullName||`${a.firstName||""} ${a.lastName||""}`.trim()||`Locataire ${a.id}`,property_id:a.property_id,admin_id:a.admin_id,status:a.status}}catch(g){return console.error(`âŒ [SENIOR DEV] Error processing tenant ${l}:`,g),{id:a.id||`unknown_${l}`,name:`Locataire ${a.id||l}`,email:"",phone:"",display_name:`Locataire ${a.id||l}`,property_id:a.property_id,admin_id:a.admin_id,status:a.status}}}),c=u.map((a,l)=>{try{return{id:a.id,title:a.title||a.name||a.propertyName||`PropriÃ©tÃ© ${a.id}`,address:a.address||"",rent:a.rent||a.monthly_rent||0,display_name:a.title||a.name||a.propertyName||`PropriÃ©tÃ© ${a.id}`,admin_id:a.admin_id,city:a.city,country:a.country}}catch(g){return console.error(`âŒ [SENIOR DEV] Error processing property ${l}:`,g),{id:a.id||`unknown_${l}`,title:`PropriÃ©tÃ© ${a.id||l}`,address:"",rent:0,display_name:`PropriÃ©tÃ© ${a.id||l}`,admin_id:a.admin_id,city:a.city,country:a.country}}});return console.log("âœ… [SENIOR DEV] Data processing completed:"),console.log("  - Processed tenants:",h.length),console.log("  - Processed properties:",c.length),h.length>0&&console.log("ðŸ‘¥ [SENIOR DEV] Sample processed tenant:",h[0]),c.length>0&&console.log("ðŸ  [SENIOR DEV] Sample processed property:",c[0]),{tenants:h,properties:c}}catch(t){console.error("âŒ [SENIOR DEV] Critical error in loadDataForCreateBill:",t),console.error("âŒ [SENIOR DEV] Error stack:",t.stack),console.log("ðŸ”„ [SENIOR DEV] Using mock data due to critical error...");const s=[{id:1,name:"Mohamed FaisalPortfolio Faisal",email:"faisal786mf7@gmail.com",phone:"+1234567890",admin_id:3,property_id:1,status:"ACTIVE",rent_amount:1e3,display_name:"Mohamed FaisalPortfolio Faisal (faisal786mf7@gmail.com)",property:{id:1,title:"Test Property 1",address:"123 Test Street",monthly_rent:1e3},admin:{id:3,name:"Mohamed Faisal",email:"faisal@property.com"}},{id:2,name:"Mohamed Faisal",email:"faisal786mf7@gmail.com",phone:"+1234567890",admin_id:4,property_id:2,status:"ACTIVE",rent_amount:1200,display_name:"Mohamed Faisal (faisal786mf7@gmail.com)",property:{id:2,title:"Test Property 2",address:"456 Test Avenue",monthly_rent:1200},admin:{id:4,name:"Mohamed Rahim",email:"rahim@property.com"}},{id:3,name:"Locataire Admin 1",email:"locataire.admin1@test.com",phone:"+1234567890",admin_id:1,property_id:3,status:"ACTIVE",rent_amount:800,display_name:"Locataire Admin 1 (locataire.admin1@test.com)",property:{id:3,title:"Test Property 3",address:"789 Test Boulevard",monthly_rent:800},admin:{id:1,name:"Default Admin",email:"admin@example.com"}}],r=[{id:1,title:"Test Property 1",address:"123 Test Street",monthly_rent:1e3,admin_id:3,display_name:"Test Property 1 - 123 Test Street"},{id:2,title:"Test Property 2",address:"456 Test Avenue",monthly_rent:1200,admin_id:4,display_name:"Test Property 2 - 456 Test Avenue"},{id:3,title:"Test Property 3",address:"789 Test Boulevard",monthly_rent:800,admin_id:1,display_name:"Test Property 3 - 789 Test Boulevard"}];return console.log("ðŸ“Š [SENIOR DEV] Mock data loaded due to error:",{tenants:s.length,properties:r.length}),{tenants:s,properties:r}}},S=()=>{if(O.length>0){const t=O[0];return{name:"Hisham",company:"Gestion Locative",address:t.address||"123 Rue de la Paix",city:t.city||"Paris",postalCode:t.postal_code||"75001",country:t.country||"France"}}return{name:"Hisham",company:"Gestion Locative",address:"123 Rue de la Paix",city:"Paris",postalCode:"75001",country:"France"}},K=async t=>{try{Y(t);const s=localStorage.getItem("token");if(!s)throw new Error("Token d'authentification manquant");const n=`http://192.168.1.109:4002/api/bills/${t}/download`;console.log("ðŸ“¥ TÃ©lÃ©chargement PDF depuis:",n);const o=await fetch(n,{method:"GET",headers:{Authorization:`Bearer ${s}`,Accept:"application/pdf"}});if(!o.ok){const C=await o.text();throw console.error("âŒ Erreur de rÃ©ponse:",o.status,C),new Error(`Ã‰chec du tÃ©lÃ©chargement (${o.status}): ${o.statusText}`)}const i=o.headers.get("content-type");(!i||!i.includes("application/pdf"))&&console.warn("âš ï¸ Type de contenu inattendu:",i);const d=o.headers.get("content-disposition");let p=`quittance-${t}.pdf`;if(d){const C=d.match(/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/);C&&C[1]&&(p=C[1].replace(/['"]/g,""))}const u=await o.blob();if(u.size===0)throw new Error("Le fichier PDF tÃ©lÃ©chargÃ© est vide");const h=await u.arrayBuffer(),c=new Uint8Array(h);String.fromCharCode(c[0],c[1],c[2],c[3])!=="%PDF"&&console.warn("âš ï¸ Le fichier tÃ©lÃ©chargÃ© ne semble pas Ãªtre un PDF valide");const l=window.URL.createObjectURL(u),g=document.createElement("a");g.href=l,g.download=p,g.style.display="none",document.body.appendChild(g),g.click(),document.body.removeChild(g),window.URL.revokeObjectURL(l),console.log("âœ… Quittance tÃ©lÃ©chargÃ©e avec succÃ¨s:",p,`(${(u.size/1024).toFixed(1)} KB)`),alert(`âœ… Quittance tÃ©lÃ©chargÃ©e avec succÃ¨s !
Fichier: ${p}
Taille: ${(u.size/1024).toFixed(1)} KB`)}catch(s){console.error("âŒ Erreur de tÃ©lÃ©chargement:",s),alert("âŒ Ã‰chec du tÃ©lÃ©chargement: "+(s.message||"Erreur inconnue"))}finally{Y(null)}},Ee=async()=>{if(v.length===0){alert("Veuillez sÃ©lectionner au moins une facture Ã  tÃ©lÃ©charger");return}for(const t of v)await K(t),await new Promise(s=>setTimeout(s,500));G([]),alert(`${v.length} facture(s) tÃ©lÃ©chargÃ©e(s) avec succÃ¨s !`)},je=t=>{G(s=>s.includes(t)?s.filter(r=>r!==t):[...s,t])},be=()=>{v.length===f.length?G([]):G(f.map(t=>t.id))},le=async t=>{if(confirm("ÃŠtes-vous sÃ»r de vouloir marquer cette facture comme payÃ©e ?"))try{$(t);try{await E.markBillAsPaid(t),await A(),await P(),alert("Facture marquÃ©e comme payÃ©e avec succÃ¨s !")}catch{console.log("ðŸ”„ API error, updating locally..."),_(r=>{const n=r.map(a=>a.id===t?{...a,status:"PAID",payment_date:new Date().toISOString().split("T")[0],payment_date_fr:new Date().toLocaleDateString("fr-FR"),status_fr:"PayÃ©",priority:"low"}:a),o=n.filter(a=>a.status==="PAID"),i=n.filter(a=>a.status==="PENDING"),d=n.filter(a=>a.status==="OVERDUE"),p=n.reduce((a,l)=>a+(l.total_amount||l.amount||0),0),u=o.reduce((a,l)=>a+(l.total_amount||l.amount||0),0),h=i.reduce((a,l)=>a+(l.total_amount||l.amount||0),0),c=d.reduce((a,l)=>a+(l.total_amount||l.amount||0),0);return T({totalBills:n.length,totalAmount:p,pendingBills:i.length,overdueBills:d.length,statusBreakdown:[{status:"PAID",count:o.length,total_amount:u},{status:"PENDING",count:i.length,total_amount:h},{status:"OVERDUE",count:d.length,total_amount:c}]}),n}),alert("Facture marquÃ©e comme payÃ©e localement ! (Serveur non disponible)")}}catch(s){alert(s.userMessage||"Ã‰chec de la mise Ã  jour de la facture")}finally{$(null)}},de=async t=>{if(confirm("ÃŠtes-vous sÃ»r de vouloir annuler le paiement de cette facture ? Le montant sera soustrait des profits."))try{$(t);try{await E.undoPayment(t),await A(),await P(),alert("Paiement annulÃ© avec succÃ¨s !")}catch{console.log("ðŸ”„ API error, updating locally..."),_(r=>{const n=r.map(a=>a.id===t?{...a,status:"PENDING",payment_date:void 0,payment_date_fr:void 0,status_fr:"En attente",priority:"medium"}:a),o=n.filter(a=>a.status==="PAID"),i=n.filter(a=>a.status==="PENDING"),d=n.filter(a=>a.status==="OVERDUE"),p=n.reduce((a,l)=>a+(l.total_amount||l.amount||0),0),u=o.reduce((a,l)=>a+(l.total_amount||l.amount||0),0),h=i.reduce((a,l)=>a+(l.total_amount||l.amount||0),0),c=d.reduce((a,l)=>a+(l.total_amount||l.amount||0),0);return T({totalBills:n.length,totalAmount:p,pendingBills:i.length,overdueBills:d.length,statusBreakdown:[{status:"PAID",count:o.length,total_amount:u},{status:"PENDING",count:i.length,total_amount:h},{status:"OVERDUE",count:d.length,total_amount:c}]}),n}),alert("Paiement annulÃ© localement ! (Serveur non disponible)")}}catch(s){alert(s.userMessage||"Ã‰chec de l'annulation du paiement")}finally{$(null)}},De=async t=>{t.preventDefault(),oe(!0),ae(!0);try{console.log("ðŸ”„ Creating bill with data:",w);const s=await E.createBill({...w,status:"PENDING"});console.log("âœ… Bill creation response:",s),se(!0),await new Promise(p=>setTimeout(p,800)),q(!1),j({tenant_id:0,property_id:0,amount:0,month:new Date().toISOString().slice(0,7),due_date:new Date().toISOString().slice(0,10),description:"Monthly rent payment"}),console.log("â³ Waiting for database to update..."),await new Promise(p=>setTimeout(p,1e3)),console.log("ðŸ”„ Refreshing bills and stats..."),await A(),await P(),console.log("âœ… Bill created and data refreshed successfully!");const r=document.createElement("div");r.className="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg notification-enter z-50";const n=document.createElement("div");n.className="flex items-center gap-2";const o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttribute("class","w-5 h-5"),o.setAttribute("fill","currentColor"),o.setAttribute("viewBox","0 0 20 20");const i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("fill-rule","evenodd"),i.setAttribute("d","M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"),i.setAttribute("clip-rule","evenodd"),o.appendChild(i);const d=document.createElement("span");d.className="font-medium",d.textContent="Facture crÃ©Ã©e avec succÃ¨s !",n.appendChild(o),n.appendChild(d),r.appendChild(n),document.body.appendChild(r),setTimeout(()=>{r.remove()},3e3)}catch(s){console.error("âŒ Error creating bill:",s),re(!0),setTimeout(()=>{re(!1)},1e3),alert("Erreur lors de la crÃ©ation de la facture: "+(s.userMessage||s.message||"Erreur inconnue"))}finally{oe(!1),ae(!1),se(!1)}},ce=(t,s)=>{ye(r=>({...r,[t]:s,page:1}))},Pe=async()=>{console.log("ðŸ”„ Manual refresh triggered");try{B(!0),x(null),I.clearCache(),await Promise.all([A(!0),P(),ne(),ie()]),console.log("âœ… Manual refresh completed - All data reloaded")}catch(t){console.error("âŒ Error during manual refresh:",t),x("Erreur lors du rafraÃ®chissement des donnÃ©es")}finally{B(!1)}},me=t=>{switch(t){case"PENDING":return e.jsx(U,{className:"w-4 h-4 text-yellow-500"});case"PAID":return e.jsx(z,{className:"w-4 h-4 text-green-500"});case"OVERDUE":return e.jsx(W,{className:"w-4 h-4 text-red-500"});case"RECEIPT_SENT":return e.jsx(z,{className:"w-4 h-4 text-blue-500"});default:return e.jsx(V,{className:"w-4 h-4 text-gray-500"})}},ue=t=>{switch(t){case"PENDING":return"bg-yellow-100 text-yellow-800";case"PAID":return"bg-green-100 text-green-800";case"OVERDUE":return"bg-red-100 text-red-800";case"RECEIPT_SENT":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}};return k&&f.length===0?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center content-fade-in",children:[e.jsxs("div",{className:"nav-item-enter-delay-1",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Gestion des Paiements"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"GÃ©rer les factures, reÃ§us et paiements"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:Pe,disabled:k,className:`bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 flex items-center gap-2 nav-transition nav-hover-lift nav-item-enter-delay-1 smooth-transition hover-lift glow-effect ${k?"opacity-75 cursor-not-allowed":""}`,title:"Actualiser les donnÃ©es",children:[e.jsx(Te,{className:`w-4 h-4 nav-icon-float smooth-transition ${k?"animate-spin":""}`}),k?"Actualisation...":"Actualiser"]}),v.length>0&&e.jsxs("button",{onClick:Ee,className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 flex items-center gap-2 nav-transition nav-hover-lift nav-item-enter-delay-2",children:[e.jsx(J,{className:"w-4 h-4 nav-icon-float-delay"}),"TÃ©lÃ©charger (",v.length,")"]}),e.jsxs("button",{onClick:async()=>{console.log("ðŸš€ Opening create bill form...");const{tenants:t,properties:s}=await we();b(t),D(s),q(!0),t.length>0||s.length>0?console.log("âœ… Create bill form opened with data loaded"):console.log("âš ï¸ No data loaded - check console for details")},className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center gap-2 nav-transition nav-hover-lift nav-item-enter-delay-3 smooth-transition hover-lift glow-effect",children:[e.jsx(pe,{className:"w-4 h-4 nav-icon-float"}),"CrÃ©er une Facture"]})]})]}),X&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(W,{className:"w-5 h-5 text-red-600 mr-2"}),e.jsx("p",{className:"text-red-600 font-medium",children:X})]}),e.jsx("button",{onClick:()=>x(null),className:"text-red-400 hover:text-red-600",children:e.jsx(V,{className:"w-4 h-4"})})]})}),R&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white p-6 rounded-lg shadow smooth-transition hover-lift fade-in",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(he,{className:"w-8 h-8 text-blue-600 smooth-transition"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Bills"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:R.totalBills})]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow smooth-transition hover-lift fade-in",style:{animationDelay:"0.1s"},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(he,{className:"w-8 h-8 text-green-600 smooth-transition"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Amount"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:["$",R.totalAmount.toFixed(2)]})]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow smooth-transition hover-lift fade-in",style:{animationDelay:"0.2s"},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(U,{className:"w-8 h-8 text-yellow-600 smooth-transition"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:R.pendingBills})]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow smooth-transition hover-lift fade-in",style:{animationDelay:"0.3s"},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(W,{className:"w-8 h-8 text-red-600 smooth-transition"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Overdue"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:R.overdueBills})]})]})})]}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow smooth-transition hover-lift fade-in",style:{animationDelay:"0.4s"},children:e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"w-4 h-4 text-gray-500"}),e.jsxs("select",{value:F.status,onChange:t=>ce("status",t.target.value),className:"border border-gray-300 rounded-md px-3 py-2 text-sm smooth-transition hover-lift focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"PENDING",children:"Pending"}),e.jsx("option",{value:"PAID",children:"Paid"}),e.jsx("option",{value:"OVERDUE",children:"Overdue"}),e.jsx("option",{value:"RECEIPT_SENT",children:"Receipt Sent"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("input",{type:"text",placeholder:"Search bills...",value:F.search,onChange:t=>ce("search",t.target.value),className:"border border-gray-300 rounded-md px-3 py-2 text-sm w-64"})})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden smooth-transition hover-lift fade-in",style:{animationDelay:"0.5s"},children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:e.jsx("input",{type:"checkbox",checked:v.length===f.length&&f.length>0,onChange:be,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500",title:"SÃ©lectionner tout"})}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Locataire"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"PropriÃ©tÃ©"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Montant"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Mois"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date d'Ã©chÃ©ance"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Statut"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:f.map((t,s)=>e.jsxs("tr",{className:"hover:bg-gray-50 smooth-transition hover-lift fade-in",style:{animationDelay:`${s*.1}s`},children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("input",{type:"checkbox",checked:v.includes(t.id),onChange:()=>je(t.id),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500",title:"SÃ©lectionner pour tÃ©lÃ©chargement"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Se,{className:"w-4 h-4 text-gray-400 mr-2"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.tenant.name}),e.jsx("div",{className:"text-sm text-gray-500",children:t.tenant.email})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ie,{className:"w-4 h-4 text-gray-400 mr-2"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.property.title}),e.jsx("div",{className:"text-sm text-gray-500",children:t.property.city})]})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:["â‚¬",(t.total_amount||t.amount).toFixed(2)]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.month}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(t.due_date).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${ue(t.status)}`,children:[me(t.status),e.jsx("span",{className:"ml-1",children:t.status.replace("_"," ")})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>M(t),className:"text-blue-600 hover:text-blue-900 nav-transition nav-hover-scale smooth-transition hover-lift",title:"Voir dÃ©tails",children:e.jsx(Re,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>K(t.id),disabled:L===t.id,className:"text-gray-600 hover:text-gray-900 disabled:opacity-50 nav-transition nav-hover-scale smooth-transition hover-lift",title:"TÃ©lÃ©charger la quittance PDF",children:L===t.id?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-600"}):e.jsx(J,{className:"w-4 h-4"})}),(t.status==="PENDING"||t.status==="OVERDUE")&&e.jsx("button",{onClick:()=>le(t.id),disabled:N===t.id,className:"text-green-600 hover:text-green-900 disabled:opacity-50 nav-transition nav-hover-scale smooth-transition hover-lift",title:"Marquer comme payÃ©e",children:N===t.id?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-green-600"}):e.jsx(z,{className:"w-4 h-4"})}),t.status==="PAID"&&e.jsx("button",{onClick:()=>de(t.id),disabled:N===t.id,className:"text-orange-600 hover:text-orange-900 disabled:opacity-50 nav-transition nav-hover-scale smooth-transition hover-lift",title:"Annuler le paiement",children:N===t.id?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-orange-600"}):e.jsx(V,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ve(t.id),disabled:ee===t.id,className:"text-red-600 hover:text-red-900 disabled:opacity-50 nav-transition nav-hover-scale smooth-transition hover-lift",title:"Supprimer la facture",children:ee===t.id?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-red-600"}):e.jsx(ke,{className:"w-4 h-4"})})]})})]},t.id))})]})}),!1]}),ge&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 fade-in",children:e.jsx("div",{className:`relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white modal-enter ${fe?"glow-effect":""} ${_e?"error-shake":""}`,children:e.jsxs("div",{className:"mt-3",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Create New Bill"}),e.jsxs("form",{onSubmit:De,className:"space-y-4",children:[e.jsxs("div",{className:"slide-in-left",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Tenant"}),e.jsxs("select",{value:w.tenant_id,onChange:t=>j(s=>({...s,tenant_id:parseInt(t.target.value)})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 smooth-transition hover-lift focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0,children:[e.jsx("option",{value:0,children:"SÃ©lectionner un locataire"}),Array.isArray(H)&&H.length>0?H.map(t=>e.jsx("option",{value:t.id,children:t.display_name||t.name||t.fullName||`Locataire ${t.id}`},t.id)):e.jsx("option",{disabled:!0,children:"Aucun locataire disponible"})]})]}),e.jsxs("div",{className:"slide-in-right",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Property"}),e.jsxs("select",{value:w.property_id,onChange:t=>j(s=>({...s,property_id:parseInt(t.target.value)})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 smooth-transition hover-lift focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0,children:[e.jsx("option",{value:0,children:"SÃ©lectionner une propriÃ©tÃ©"}),Array.isArray(O)&&O.length>0?O.map(t=>e.jsx("option",{value:t.id,children:t.display_name||t.title||t.name||`PropriÃ©tÃ© ${t.id}`},t.id)):e.jsx("option",{disabled:!0,children:"Aucune propriÃ©tÃ© disponible"})]})]}),e.jsxs("div",{className:"slide-in-left",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Amount"}),e.jsx("input",{type:"number",step:"0.01",value:w.amount,onChange:t=>j(s=>({...s,amount:parseFloat(t.target.value)})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 smooth-transition hover-lift focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})]}),e.jsxs("div",{className:"slide-in-right",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Month"}),e.jsx("input",{type:"month",value:w.month,onChange:t=>j(s=>({...s,month:t.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 smooth-transition hover-lift focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})]}),e.jsxs("div",{className:"slide-in-left",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Due Date"}),e.jsx("input",{type:"date",value:w.due_date,onChange:t=>j(s=>({...s,due_date:t.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 smooth-transition hover-lift focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})]}),e.jsxs("div",{className:"slide-in-right",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Description"}),e.jsx("textarea",{value:w.description,onChange:t=>j(s=>({...s,description:t.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 smooth-transition hover-lift focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:3})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>q(!1),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 smooth-transition hover-lift",children:"Annuler"}),e.jsx("button",{type:"submit",disabled:Z,className:`px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 smooth-transition hover-lift ${Z?"opacity-50 cursor-not-allowed":""} ${xe?"success-bounce":""}`,children:Z?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full loading-spinner"}),e.jsx("span",{children:"CrÃ©ation..."})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4"}),e.jsx("span",{children:"CrÃ©er la Facture"})]})})]})]})]})})}),m&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 fade-in",children:e.jsx("div",{className:"relative top-10 mx-auto p-0 border w-full max-w-2xl shadow-lg rounded-md bg-white modal-enter",children:e.jsxs("div",{className:"mt-0",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-800 text-white p-6 rounded-t-md",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"QUITTANCE DE LOYER"}),e.jsx("p",{className:"text-blue-100 text-sm",children:"ReÃ§u de paiement de loyer"})]}),e.jsx("button",{onClick:()=>M(null),className:"text-white hover:text-blue-200 transition-colors smooth-transition hover-lift",children:e.jsx(V,{className:"w-6 h-6"})})]})}),e.jsxs("div",{className:"p-6 bg-white",children:[e.jsx("div",{className:"border-b border-gray-200 pb-4 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:S().name}),e.jsx("p",{className:"text-sm text-gray-600",children:S().company}),e.jsx("p",{className:"text-sm text-gray-600",children:S().address}),e.jsxs("p",{className:"text-sm text-gray-600",children:[S().postalCode," ",S().city,", ",S().country]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Locataire"}),e.jsx("p",{className:"text-sm text-gray-600 font-medium",children:m.tenant.name}),e.jsx("p",{className:"text-sm text-gray-600",children:m.tenant.email}),e.jsx("p",{className:"text-sm text-gray-600",children:m.tenant.phone})]})]})}),e.jsxs("div",{className:"border-b border-gray-200 pb-4 mb-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"DÃ©tails du Bien"}),e.jsx("p",{className:"text-sm text-gray-600 font-medium",children:m.property.title}),e.jsx("p",{className:"text-sm text-gray-600",children:m.property.address}),e.jsx("p",{className:"text-sm text-gray-600",children:m.property.city})]}),e.jsxs("div",{className:"border-b border-gray-200 pb-4 mb-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"DÃ©tail du rÃ¨glement :"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-700",children:"Loyer :"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:["â‚¬",(m.rent_amount||m.amount).toFixed(2)," euros"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-700",children:"(le cas Ã©chÃ©ant, contribution aux Ã©conomies d'Ã©nergies) :"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:["â‚¬",(m.charges||0).toFixed(2)," euros"]})]}),e.jsx("div",{className:"border-t border-gray-300 pt-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg font-bold text-gray-900",children:"Total :"}),e.jsxs("span",{className:"text-xl font-bold text-blue-600",children:["â‚¬",(m.total_amount||m.amount).toFixed(2)," euros"]})]})})]})})]}),e.jsx("div",{className:"border-b border-gray-200 pb-4 mb-6",children:e.jsx("div",{className:"bg-green-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-700 font-medium",children:"Date du paiement :"}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:["le ",m.payment_date?new Date(m.payment_date).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}):"...... / ...... / 20......"]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"PÃ©riode"}),e.jsx("p",{className:"text-blue-800",children:m.month}),e.jsxs("p",{className:"text-sm text-blue-600",children:["Ã‰chÃ©ance: ",new Date(m.due_date).toLocaleDateString("fr-FR")]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"Statut"}),e.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${ue(m.status)}`,children:[me(m.status),e.jsx("span",{className:"ml-2",children:m.status.replace("_"," ")})]})]})]}),m.description&&e.jsxs("div",{className:"border-b border-gray-200 pb-4 mb-6",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"Description"}),e.jsx("p",{className:"text-sm text-gray-600",children:m.description})]}),e.jsxs("div",{className:"text-center text-xs text-gray-500 border-t border-gray-200 pt-4",children:[e.jsx("p",{children:"Ce reÃ§u fait foi de paiement du loyer pour la pÃ©riode indiquÃ©e."}),e.jsxs("p",{className:"mt-1",children:["GÃ©nÃ©rÃ© le ",new Date().toLocaleDateString("fr-FR")," Ã  ",new Date().toLocaleTimeString("fr-FR")]})]}),e.jsx("div",{className:"pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[(m.status==="PENDING"||m.status==="OVERDUE")&&e.jsx("button",{onClick:()=>{le(m.id),M(null)},disabled:N===m.id,className:"flex items-center justify-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors smooth-transition hover-lift",children:N===m.id?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"w-4 h-4 mr-2 animate-spin"}),"Marquage en cours..."]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Marquer comme payÃ©e"]})}),m.status==="PAID"&&e.jsx("button",{onClick:()=>{de(m.id),M(null)},disabled:N===m.id,className:"flex items-center justify-center px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors smooth-transition hover-lift",children:N===m.id?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"w-4 h-4 mr-2 animate-spin"}),"Annulation en cours..."]}):e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Annuler le paiement"]})}),e.jsx("button",{onClick:()=>K(m.id),disabled:L===m.id,className:"flex items-center justify-center px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors smooth-transition hover-lift",children:L===m.id?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"w-4 h-4 mr-2 animate-spin"}),"TÃ©lÃ©chargement en cours..."]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"ðŸ“„ TÃ©lÃ©charger la Quittance PDF"]})})]})})]})]})})})]})};export{ze as default};

import{j as e}from"./index-BRkigiy4.js";import{r as a}from"./router-DUq0sin2.js";import S from"./api-DQwSXtBv.js";import{n as p}from"./Dashboard-Dh4ppiET.js";import{X as me,v as Te,J as ue,j as ve,s as Ae,x as _e,H as Le,K as Ne,B as we,k as Fe,A as Re}from"./icons-ByKMif1I.js";/* empty css                            */import"./vendor-Bzgz95E1.js";import"./utils-B9HHbEsj.js";import"./charts-DdKZH6bc.js";const Ue=({propertyId:v,onClose:C})=>{const[k,$]=a.useState([]),[_,F]=a.useState(!1),[N,R]=a.useState(!1),[x,f]=a.useState(""),[b,I]=a.useState(null),[E,M]=a.useState([]);a.useEffect(()=>{T()},[v]),a.useEffect(()=>()=>{E.forEach(s=>{s.startsWith("blob:")&&URL.revokeObjectURL(s)})},[E]);const T=async()=>{try{F(!0);const y=((await S.getPropertyPhotos(v)).data?.data?.photos||[]).map(g=>({...g,file_url:p(g.file_url)}));$(y)}catch(s){console.error("Error fetching photos:",s),f(s.userMessage||"Failed to fetch photos")}finally{F(!1)}},O=s=>{const c=s.target.files;if(c&&c.length>0){I(c);const y=[];for(let g=0;g<c.length;g++)y.push(URL.createObjectURL(c[g]));M(y)}},G=async()=>{if(!b||b.length===0){f("Please select at least one photo");return}R(!0),f("");try{const s=new FormData;for(let g=0;g<b.length;g++)s.append("photos",b[g]);console.log("Uploading photos for property:",v),console.log("Files to upload:",b.length);const c=await S.uploadPropertyPhotos(v,s);console.log("Upload response:",c),I(null),M([]),await T();const y=document.getElementById("photo-upload");y&&(y.value=""),f("")}catch(s){console.error("Error uploading photos:",s),console.error("Error details:",s.response?.data),f(s.userMessage||s.message||"Failed to upload photos")}finally{R(!1)}},z=async s=>{if(confirm("Are you sure you want to delete this photo?"))try{await S.deletePropertyPhoto(v,s),await T()}catch(c){console.error("Error deleting photo:",c),f(c.userMessage||"Failed to delete photo")}},J=async s=>{try{await S.setPrimaryPropertyPhoto(v,s),await T()}catch(c){console.error("Error setting primary photo:",c),f(c.userMessage||"Failed to set primary photo")}},B=()=>{I(null),M([]);const s=document.getElementById("photo-upload");s&&(s.value="")},X=s=>s<1024?s+" B":s<1024*1024?(s/1024).toFixed(1)+" KB":(s/(1024*1024)).toFixed(1)+" MB";return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-5xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 sticky top-0 bg-white z-10",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"Property Photos"}),e.jsx("button",{onClick:C,className:"text-gray-400 hover:text-gray-600 transition-colors",title:"Close",children:e.jsx(me,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 bg-gray-50",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Upload New Photos"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{children:e.jsxs("label",{htmlFor:"photo-upload",className:"flex items-center justify-center w-full px-4 py-3 border border-gray-300 rounded-lg cursor-pointer bg-white hover:bg-gray-100 transition-colors",children:[e.jsx(Te,{className:"w-5 h-5 mr-2 text-gray-600"}),e.jsx("span",{className:"text-gray-700",children:"Choose Photos (Max 10 files, 10MB each)"}),e.jsx("input",{id:"photo-upload",type:"file",accept:"image/*",multiple:!0,onChange:O,className:"hidden"})]})}),b&&b.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[b.length," file(s) selected"]}),e.jsx("button",{onClick:B,className:"text-sm text-red-600 hover:text-red-800",children:"Clear Selection"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:E.map((s,c)=>e.jsx("div",{className:"relative",children:e.jsx("img",{src:s,alt:`Preview ${c+1}`,className:"w-full h-24 object-cover rounded border border-gray-300"})},c))}),e.jsx("button",{onClick:G,disabled:N,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed",children:N?"Uploading...":"Upload Photos"})]})]})]}),x&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:x}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:["Uploaded Photos (",k.length,")"]}),_?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Loading photos..."})]}):k.length===0?e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[e.jsx(ue,{className:"w-12 h-12 mx-auto text-gray-400 mb-3"}),e.jsx("p",{className:"text-gray-600",children:"No photos uploaded yet"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Upload your first photo above"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:k.map(s=>e.jsxs("div",{className:"relative border border-gray-200 rounded-lg overflow-hidden bg-white shadow-sm hover:shadow-md transition-shadow",children:[s.is_primary&&e.jsxs("div",{className:"absolute top-2 left-2 bg-yellow-500 text-white px-2 py-1 rounded-full text-xs font-semibold flex items-center z-10",children:[e.jsx(ve,{className:"w-3 h-3 mr-1 fill-current"}),"Primary"]}),e.jsx("div",{className:"h-48 bg-gray-100",children:e.jsx("img",{src:p(s.file_url),alt:s.original_filename,className:"w-full h-full object-cover",onError:c=>{console.error("Image load error for:",s.file_url),c.currentTarget.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI2VlZSIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LXNpemU9IjE4IiBmaWxsPSIjYWFhIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSI+SW1hZ2UgRXJyb3I8L3RleHQ+PC9zdmc+"},onLoad:()=>{console.log("Image loaded successfully:",s.file_url)}})}),e.jsxs("div",{className:"p-3",children:[e.jsx("p",{className:"text-sm text-gray-900 truncate mb-1",title:s.original_filename,children:s.original_filename}),e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:X(s.file_size)}),e.jsxs("div",{className:"flex items-center gap-2",children:[!s.is_primary&&e.jsxs("button",{onClick:()=>J(s.id),className:"flex-1 flex items-center justify-center px-2 py-1.5 text-xs bg-yellow-50 text-yellow-700 rounded hover:bg-yellow-100 transition-colors",title:"Set as primary photo",children:[e.jsx(ve,{className:"w-3 h-3 mr-1"}),"Set Primary"]}),e.jsx("a",{href:p(s.file_url),target:"_blank",rel:"noopener noreferrer",download:!0,className:"flex items-center justify-center px-2 py-1.5 text-xs bg-blue-50 text-blue-700 rounded hover:bg-blue-100 transition-colors",title:"Download photo",children:e.jsx(Ae,{className:"w-3 h-3"})}),e.jsx("button",{onClick:()=>z(s.id),className:"flex items-center justify-center px-2 py-1.5 text-xs bg-red-50 text-red-700 rounded hover:bg-red-100 transition-colors",title:"Delete photo",children:e.jsx(_e,{className:"w-3 h-3"})})]})]})]},s.id))})]})]}),e.jsx("div",{className:"flex items-center justify-end p-6 border-t border-gray-200 bg-gray-50",children:e.jsx("button",{onClick:C,className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"Close"})})]})})},Ze=()=>{const[v,C]=a.useState([]),[k,$]=a.useState(""),[_,F]=a.useState(""),[N,R]=a.useState(""),[x,f]=a.useState(""),[b,I]=a.useState("APARTMENT"),[E,M]=a.useState(""),[T,O]=a.useState(""),[G,z]=a.useState(""),[J,B]=a.useState(""),[X,s]=a.useState(""),[c,y]=a.useState(""),[g,K]=a.useState(""),[he,Q]=a.useState(""),[U,Y]=a.useState(null),[ae,V]=a.useState(null),[pe,ee]=a.useState(!1),[fe,P]=a.useState(""),[ge,W]=a.useState(""),[q,le]=a.useState(!1),[xe,ne]=a.useState(null),[Pe,te]=a.useState(!1),[be,ie]=a.useState(null),[ce,ye]=a.useState(!1);a.useEffect(()=>{let t=!0;const d=async()=>{if(!(x.trim()||!_.trim()||!N.trim())&&!q&&t){ye(!0);try{const l=`${_}, ${N}, France`,i=await fetch(`https://api-adresse.data.gouv.fr/search/?q=${encodeURIComponent(l)}&limit=1`,{signal:AbortSignal.timeout(5e3)});if(!t)return;if(i.ok){const o=await i.json();if(o?.features&&Array.isArray(o.features)&&o.features.length>0){const n=o.features[0]?.properties?.postcode;n&&t&&f(n)}}}catch(l){l.name!=="AbortError"&&t&&console.log("Postal code auto-detection failed:",l?.message||l)}finally{t&&ye(!1)}}},r=setTimeout(()=>{d()},1e3);return()=>{t=!1,clearTimeout(r)}},[_,N,x,q]);const se=async()=>{try{if(!localStorage.getItem("token")){console.log("No token found, skipping properties API call"),C([]);return}ee(!0),P(""),console.log("üè† Fetching properties with photos...");const d=await S.listProperties();if(console.log("üì° API Response:",d.data),d.data?.success&&d.data?.data?.properties){const r=d.data.data.properties;if(!Array.isArray(r)){console.error("‚ùå Properties data is not an array:",r),C([]);return}console.log("üìã Raw properties from API:",r.length);const i=(await Promise.all(r.map(async o=>{if(!o||!o.id)return console.warn("‚ö†Ô∏è Invalid property data:",o),null;let n=[];try{const u=await S.getPropertyPhotos(o.id);if(u?.data?.success&&u?.data?.data?.photos){const D=u.data.data.photos;Array.isArray(D)?(n=D.map(m=>!m||!m.file_url?(console.warn("‚ö†Ô∏è Invalid photo data:",m),null):{...m,display_url:p(m.file_url||""),created_at_fr:m.created_at?new Date(m.created_at).toLocaleDateString("fr-FR"):"",updated_at_fr:m.updated_at?new Date(m.updated_at).toLocaleDateString("fr-FR"):null}).filter(m=>m!==null),console.log(`‚úÖ Loaded ${n.length} photo(s) for property ${o.id}`)):console.warn(`‚ö†Ô∏è Photos data is not an array for property ${o.id}:`,D)}else console.log(`‚ÑπÔ∏è No photos found for property ${o.id}`)}catch(u){console.warn(`‚ö†Ô∏è Could not fetch photos for property ${o.id}:`,u?.message||u),o.photo&&console.log(`‚ÑπÔ∏è Using fallback photo field for property ${o.id}`)}const A=n.find(u=>u.is_primary===!0)||n.find(u=>u.is_primary===1)||n[0]||null;return{...o,photos:n,primary_photo:A,display_title:o.title||o.name||"Propri√©t√© sans nom",display_address:`${o.address||""}, ${o.city||""}${o.postal_code?" "+o.postal_code:""}`.trim(),rent_formatted:new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(o.monthly_rent||o.rent||0),photo_count:n.length,has_photos:n.length>0,_debug:{hasPhotos:n.length>0,primaryPhotoExists:!!A,primaryPhotoUrl:A?.file_url||A?.display_url||null}}}))).filter(o=>o!==null);console.log("‚úÖ Properties fetched with photos:",i.length,"properties"),C(i)}else console.log("‚ùå Invalid response structure:",d.data),C([])}catch(t){console.error("‚ùå Failed to fetch properties:",t),P("Erreur lors du chargement des propri√©t√©s"),C([])}finally{ee(!1)}};a.useEffect(()=>{se()},[]);const Se=()=>{if(!k.trim())return"Title is required";if(k.trim().length<3)return"Le titre doit contenir au moins 3 caract√®res";if(k.trim().length>255)return"Le titre doit contenir moins de 255 caract√®res";if(!_.trim())return"L'adresse est requise";if(_.trim().length<5)return"L'adresse doit contenir au moins 5 caract√®res";if(!N.trim())return"La ville est requise";if(N.trim().length<2)return"La ville doit contenir au moins 2 caract√®res";if(!x.trim())return"Le code postal est requis";if(x.trim().length<3)return"Le code postal doit contenir au moins 3 caract√®res";if(x.trim().length>20)return"Le code postal doit contenir moins de 20 caract√®res";if(!b.trim())return"Le type de propri√©t√© est requis";const t=parseFloat(E);if(E&&(isNaN(t)||t<=0))return"Le montant du loyer doit √™tre un nombre positif";if(t>1e6)return"Le montant du loyer semble anormalement √©lev√©. Veuillez v√©rifier.";const d=T.trim();return d&&d.length>2e3?"La description doit contenir moins de 2000 caract√®res":null},ke=async t=>{t.preventDefault();const d=Se();if(d){P(d);return}if(!x.trim()){P("Le code postal est requis. Veuillez attendre la d√©tection automatique ou l'entrer manuellement.");return}ee(!0),P("");try{const r=new FormData;r.append("title",k.trim()),r.append("address",_.trim()),r.append("city",N.trim()),r.append("postal_code",x.trim()),r.append("property_type",b);const l=parseFloat(E);!isNaN(l)&&l>0&&r.append("monthly_rent",l.toString());const i=T.trim();i&&r.append("description",i),U?(r.append("photo",U),console.log("üì§ Appending photo to formData:",{fileName:U.name,fileSize:U.size,fileType:U.type})):console.log("‚ÑπÔ∏è No photo file to append");const o=parseInt(G);r.append("number_of_halls",(!isNaN(o)&&o>=0?o:0).toString());const n=parseInt(J);r.append("number_of_kitchens",(!isNaN(n)&&n>=0?n:0).toString());const A=parseInt(X);r.append("number_of_bathrooms",(!isNaN(A)&&A>=0?A:0).toString());const u=parseInt(c);r.append("number_of_parking_spaces",(!isNaN(u)&&u>=0?u:0).toString());const D=parseInt(g);r.append("number_of_rooms",(!isNaN(D)&&D>=0?D:0).toString());const m=parseInt(he);r.append("number_of_gardens",(!isNaN(m)&&m>=0?m:0).toString());let w;if(q&&xe?w=await S.updateProperty(xe,r):w=await S.createProperty(r),!w?.data?.success)throw new Error(w?.data?.error||"√âchec de l'enregistrement de la propri√©t√©");w?.data?.warning&&(console.warn("‚ö†Ô∏è Property saved with warning:",w.data.warning),P(w.data.warning));const Ee=q?"Propri√©t√© mise √† jour avec succ√®s !":"Propri√©t√© cr√©√©e avec succ√®s !";w?.data?.warning||P(""),W(Ee),$(""),F(""),R(""),f(""),I("APARTMENT"),M(""),O(""),z(""),B(""),s(""),y(""),K(""),Q(""),Y(null),V(null),le(!1),ne(null),te(!1);const re=w?.data?.data?.property?.id,Me=!!U;if(console.log("üîÑ Immediate refresh to show new property..."),await se(),re&&Me){console.log("üì∏ Photo was uploaded, verifying primary photo creation..."),console.log("   Created property ID:",re),console.log("   Response data:",w?.data?.data);const Z=w?.data?.data?.property;if(Z?.photos&&Z.photos.length>0){console.log("‚úÖ Photos found in response:",Z.photos.length);const h=Z.photos.find(L=>L.is_primary===!0)||Z.photos[0];h&&console.log("‚úÖ Primary photo in response:",{photoId:h.id,fileUrl:h.file_url,filePath:h.file_path})}await new Promise(h=>setTimeout(h,1500));let j=0,de=!1;for(;j<3&&!de;)try{const h=await S.getPropertyPhotos(re);if(console.log(`üì∏ Photo check attempt ${j+1}:`,h?.data),h?.data?.success&&h?.data?.data?.photos){const L=h.data.data.photos,H=L.find(oe=>oe.is_primary===!0||oe.is_primary===1)||L[0];H?(console.log(`‚úÖ Primary photo found for property ${re}:`,{photoId:H.id,isPrimary:H.is_primary,fileUrl:H.file_url,filePath:H.file_path,displayUrl:p(H.file_url||"")}),de=!0):(j++,j<3&&(console.log(`‚è≥ Retry ${j}/3: Waiting for primary photo...`),await new Promise(oe=>setTimeout(oe,1e3))))}else j++,j<3&&(console.log(`‚è≥ Retry ${j}/3: No photos yet, waiting...`),await new Promise(L=>setTimeout(L,1e3)))}catch(h){j++,console.warn(`‚ö†Ô∏è Error checking photos (attempt ${j}/3):`,h?.message||h),j<3&&await new Promise(L=>setTimeout(L,1e3))}await se(),de?console.log("‚úÖ Primary photo verified and displayed"):(console.warn(`‚ö†Ô∏è Primary photo not found after ${j} attempts`),console.warn("   This could indicate:"),console.warn("   - Photo upload failed silently"),console.warn("   - PropertyPhoto record was not created"),console.warn("   - Database transaction issue"))}else console.log("‚úÖ Property created without photo, list refreshed");setTimeout(()=>{W("")},3e3)}catch(r){console.error("Property submission error:",r);let l="√âchec de l'enregistrement de la propri√©t√©";if(r?.response?.data){const i=r.response.data;i.details&&Array.isArray(i.details)?l=`Erreurs de validation : ${i.details.map(n=>n.msg||n.message).join(", ")}`:i.error&&(l=i.error)}else r?.userMessage?l=r.userMessage:r?.message&&(l=r.message);P(l),W("")}finally{ee(!1)}},Ce=t=>{$(t.title),F(t.address),R(t.city),f(t.postal_code||""),I(t.property_type),M(t.monthly_rent?.toString()||""),O(t.description||""),z(t.number_of_halls?.toString()||""),B(t.number_of_kitchens?.toString()||""),s(t.number_of_bathrooms?.toString()||""),y(t.number_of_parking_spaces?.toString()||""),K(t.number_of_rooms?.toString()||""),Q(t.number_of_gardens?.toString()||""),le(!0),ne(t.id.toString()),te(!0)},je=()=>{$(""),F(""),R(""),f(""),I("APARTMENT"),M(""),O(""),z(""),B(""),s(""),y(""),K(""),Q(""),Y(null),V(null),le(!1),ne(null),te(!1),P(""),W("")},Ie=async t=>{if(confirm("Delete this property?"))try{await S.deleteProperty(t.toString()),await se()}catch(d){alert(d?.response?.data?.error||"Failed to delete")}};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-4 md:mb-6 fade-in-soft",children:[e.jsxs("div",{className:"slide-in-left",children:[e.jsx("h1",{className:"text-xl md:text-2xl font-bold text-gray-900",children:"Propri√©t√©s"}),e.jsx("p",{className:"text-gray-600 mt-1 text-sm md:text-base",children:"G√©rer vos propri√©t√©s et leurs photos"})]}),e.jsx("div",{className:"slide-in-right w-full sm:w-auto",children:e.jsxs("button",{onClick:()=>{P(""),W(""),te(!0)},className:"bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center justify-center space-x-2 hover:bg-blue-700 smooth-transition hover-lift-strong glow-effect w-full sm:w-auto text-sm md:text-base",children:[e.jsx(Le,{className:"w-4 h-4 smooth-transition"}),e.jsx("span",{children:"Ajouter Propri√©t√©"})]})})]}),Pe&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 fade-in",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto modal-enter",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 md:p-6 border-b border-gray-200 sticky top-0 bg-white z-10",children:[e.jsx("h2",{className:"text-lg md:text-xl font-semibold text-gray-900",children:q?"Modifier la Propri√©t√©":"Ajouter une Nouvelle Propri√©t√©"}),e.jsx("button",{onClick:je,className:"text-gray-400 hover:text-gray-600 p-1",title:"Fermer le modal","aria-label":"Fermer le modal",children:e.jsx(me,{className:"w-5 h-5 md:w-6 md:h-6"})})]}),e.jsxs("form",{onSubmit:ke,className:"p-4 md:p-6 space-y-3 md:space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4",children:[e.jsxs("div",{className:"slide-in-left",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Titre *"}),e.jsx("input",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 smooth-transition hover-lift",placeholder:"Titre de la Propri√©t√©",value:k,onChange:t=>$(t.target.value),required:!0})]}),e.jsxs("div",{className:"slide-in-right",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Adresse *"}),e.jsx("input",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 smooth-transition hover-lift",placeholder:"Adresse de la Propri√©t√©",value:_,onChange:t=>F(t.target.value),required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ville *"}),e.jsx("input",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ville",value:N,onChange:t=>R(t.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Code Postal *",ce&&e.jsx("span",{className:"ml-2 text-xs text-gray-500",children:"(Recherche...)"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Code Postal (d√©tection automatique)",value:x,onChange:t=>f(t.target.value),required:!0}),ce&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"})})]}),_&&N&&!x&&!ce&&e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Le code postal sera d√©tect√© automatiquement"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Type de Propri√©t√© *"}),e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",value:b,onChange:t=>I(t.target.value),required:!0,"aria-label":"Type de Propri√©t√©",id:"property-type",children:[e.jsx("option",{value:"APARTMENT",children:"Appartement"}),e.jsx("option",{value:"HOUSE",children:"Maison"}),e.jsx("option",{value:"STUDIO",children:"Studio"}),e.jsx("option",{value:"OTHER",children:"Autre"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Loyer Mensuel"}),e.jsx("input",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Loyer Mensuel",type:"number",step:"0.01",value:E,onChange:t=>M(t.target.value)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Description de la Propri√©t√©",value:T,onChange:t=>O(t.target.value),rows:3})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"D√©tails de la Propri√©t√© (Optionnel)"}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3 md:gap-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 h-10 flex items-center",children:"Nombre de Halls"}),e.jsx("input",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 h-10",placeholder:"0",type:"number",min:"0",value:G,onChange:t=>z(t.target.value)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 h-10 flex items-center",children:"Nombre de Cuisines"}),e.jsx("input",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 h-10",placeholder:"0",type:"number",min:"0",value:J,onChange:t=>B(t.target.value)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 h-10 flex items-center",children:"Nombre de Salles de Bain"}),e.jsx("input",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 h-10",placeholder:"0",type:"number",min:"0",value:X,onChange:t=>s(t.target.value)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 h-10 flex items-center",children:"Nombre de Places de Parking"}),e.jsx("input",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 h-10",placeholder:"0",type:"number",min:"0",value:c,onChange:t=>y(t.target.value)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 h-10 flex items-center",children:"Nombre de Chambres"}),e.jsx("input",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 h-10",placeholder:"0",type:"number",min:"0",value:g,onChange:t=>K(t.target.value)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 h-10 flex items-center",children:"Nombre de Jardins"}),e.jsx("input",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 h-10",placeholder:"0",type:"number",min:"0",value:he,onChange:t=>Q(t.target.value)})]})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-6 mt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Image de la Propri√©t√©"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex flex-col items-center justify-center w-32 h-32 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-blue-500 hover:bg-blue-50 transition-colors",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[e.jsx(Ne,{className:"w-8 h-8 text-gray-400 mb-2"}),e.jsxs("p",{className:"text-sm text-gray-600 text-center px-2",children:[U?"Changer":"Ajouter"," une image"]})]}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:t=>{const d=t.target.files?.[0]||null;if(Y(d||null),d){const r=URL.createObjectURL(d);V(r)}else V(null)}})]}),ae&&e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:ae,alt:"Aper√ßu",className:"w-32 h-32 object-cover rounded-lg border-2 border-gray-200 shadow-sm"}),e.jsx("button",{type:"button",onClick:()=>{Y(null),V(null)},className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 transition-colors",title:"Supprimer l'image",children:e.jsx(me,{className:"w-4 h-4"})})]})]}),!ae&&e.jsx("p",{className:"text-sm text-gray-500",children:"Format accept√© : JPG, PNG, GIF. Taille recommand√©e : 800x600px"})]})]}),fe&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:[e.jsx("p",{className:"font-semibold",children:"Erreur"}),e.jsx("p",{className:"text-sm",children:fe})]}),ge&&e.jsxs("div",{className:"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg",children:[e.jsx("p",{className:"font-semibold",children:"Succ√®s"}),e.jsx("p",{className:"text-sm",children:ge})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center justify-end gap-2 sm:gap-3 pt-4 border-t border-gray-200 sticky bottom-0 bg-white",children:[e.jsx("button",{type:"button",onClick:je,className:"w-full sm:w-auto px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors text-sm md:text-base",children:"Annuler"}),e.jsx("button",{type:"submit",disabled:pe,className:"w-full sm:w-auto px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed text-sm md:text-base",children:pe?"Enregistrement...":q?"Mettre √† Jour la Propri√©t√©":"Ajouter Propri√©t√©"})]})]})]})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:v&&Array.isArray(v)&&v.length>0?v.map((t,d)=>e.jsxs("div",{className:`bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden nav-hover-lift nav-item-enter-delay-${Math.min(d+1,7)}`,children:[e.jsxs("div",{className:"h-48 bg-gray-100 flex items-center justify-center relative group",children:[t.primary_photo?e.jsx("img",{src:t.primary_photo.display_url||p(t.primary_photo.file_url||""),alt:t.display_title,crossOrigin:"anonymous",loading:"lazy",className:"w-full h-48 object-cover transition-transform duration-300 group-hover:scale-105",onError:r=>{const l=r.currentTarget.src;if(console.warn(`‚ùå Failed to load primary image for property ${t.id}:`,{propertyId:t.id,primaryPhoto:t.primary_photo,original_url:t.primary_photo?.file_url,display_url:t.primary_photo?.display_url,current_src:l,normalized_url:p(t.primary_photo?.file_url||""),hasPhotos:(t.photos?.length||0)>0,photoCount:t.photo_count}),t.photos&&t.photos.length>0&&t.photos[0]?.file_url){const n=p(t.photos[0].file_url);if(l!==n){r.currentTarget.src=n;return}}if(t.photo&&l!==p(t.photo)){r.currentTarget.src=p(t.photo);return}const i=r.currentTarget;i.style.display="none";const o=i.parentElement;if(o&&!o.querySelector(".placeholder-shown")){const n=document.createElement("div");n.className="placeholder-shown flex flex-col items-center justify-center h-full w-full bg-gradient-to-br from-blue-50 to-indigo-100",n.innerHTML=`
                        <div class="w-20 h-20 bg-white/80 rounded-2xl flex items-center justify-center mb-3 shadow-lg">
                          <svg class="w-10 h-10 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                          </svg>
                        </div>
                        <p class="text-xs text-blue-600 font-medium">Aucune photo</p>
                      `,o.appendChild(n)}},onLoad:r=>{console.log(`‚úÖ Primary image loaded successfully for property ${t.id}:`,{url:r.currentTarget.src,propertyId:t.id})}}):t.photos&&t.photos.length>0?e.jsx("img",{src:t.photos[0]?.display_url||p(t.photos[0]?.file_url||""),alt:t.display_title,crossOrigin:"anonymous",loading:"lazy",className:"w-full h-48 object-cover transition-transform duration-300 group-hover:scale-105",onError:r=>{if(console.warn(`‚ùå Failed to load first image for property ${t.id}:`,{original_url:t.photos?.[0]?.file_url,display_url:t.photos?.[0]?.display_url,current_src:r.currentTarget.src,error:"Image failed to load - check CORS/CSP headers"}),t.photo&&r.currentTarget.src!==p(t.photo)){r.currentTarget.src=p(t.photo);return}const l=r.currentTarget;l.style.display="none";const i=l.parentElement;if(i&&!i.querySelector(".placeholder-shown")){const o=document.createElement("div");o.className="placeholder-shown flex flex-col items-center justify-center h-full w-full bg-gradient-to-br from-blue-50 to-indigo-100",o.innerHTML=`
                        <div class="w-20 h-20 bg-white/80 rounded-2xl flex items-center justify-center mb-3 shadow-lg">
                          <svg class="w-10 h-10 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                          </svg>
                        </div>
                        <p class="text-xs text-blue-600 font-medium">Aucune photo</p>
                      `,i.appendChild(o)}},onLoad:()=>{console.log(`‚úÖ First image loaded successfully for property ${t.id}`)}}):t.photo?e.jsx("img",{src:p(t.photo),alt:t.display_title,crossOrigin:"anonymous",loading:"lazy",className:"w-full h-48 object-cover transition-transform duration-300 group-hover:scale-105",onError:r=>{console.warn(`‚ùå Failed to load property photo for property ${t.id}:`,{photo_url:t.photo,current_src:r.currentTarget.src,error:"Image failed to load"});const l=r.currentTarget;l.style.display="none";const i=l.parentElement;if(i&&!i.querySelector(".placeholder-shown")){const o=document.createElement("div");o.className="placeholder-shown flex items-center justify-center h-full w-full bg-gray-200",o.innerHTML='<svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path></svg>',i.appendChild(o)}},onLoad:()=>{console.log(`‚úÖ Property photo loaded successfully for property ${t.id}`)}}):e.jsx("div",{className:"flex items-center justify-center h-full w-full bg-gray-200",children:e.jsx(we,{className:"w-12 h-12 text-gray-400"})}),t.photo_count>0&&e.jsxs("div",{className:"absolute top-2 left-2 bg-black bg-opacity-50 text-white px-2 py-1 rounded-full text-xs flex items-center gap-1",children:[e.jsx(Ne,{className:"w-3 h-3"}),t.photo_count]}),t.rent_formatted&&e.jsxs("div",{className:"absolute top-2 right-2 bg-blue-600 text-white px-3 py-1 rounded-full text-sm font-semibold",children:[t.rent_formatted,"/mois"]}),e.jsx("div",{className:"absolute bottom-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:e.jsx("button",{onClick:()=>ie(t.id),className:"bg-white bg-opacity-90 text-gray-700 p-2 rounded-full hover:bg-opacity-100 transition-all duration-200 nav-transition nav-hover-scale",title:"G√©rer les photos",children:e.jsx(ue,{className:"w-4 h-4"})})})]}),e.jsxs("div",{className:"p-5",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:t.display_title}),e.jsxs("div",{className:"flex items-center text-gray-600 mb-2",children:[e.jsx(Fe,{className:"w-4 h-4 mr-1 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:t.display_address})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs text-gray-600 mb-3",children:[e.jsxs("div",{children:["Halls: ",e.jsx("span",{className:"font-medium",children:t.number_of_halls??0})]}),e.jsxs("div",{children:["Cuisines: ",e.jsx("span",{className:"font-medium",children:t.number_of_kitchens??0})]}),e.jsxs("div",{children:["Salles de bain: ",e.jsx("span",{className:"font-medium",children:t.number_of_bathrooms??0})]}),e.jsxs("div",{children:["Parking: ",e.jsx("span",{className:"font-medium",children:t.number_of_parking_spaces??0})]}),e.jsxs("div",{children:["Chambres: ",e.jsx("span",{className:"font-medium",children:t.number_of_rooms??0})]}),e.jsxs("div",{children:["Jardins: ",e.jsx("span",{className:"font-medium",children:t.number_of_gardens??0})]})]}),e.jsxs("div",{className:"flex items-center text-gray-500 text-sm mb-3",children:[e.jsxs("span",{children:[t.city,t.postal_code?" "+t.postal_code:""]}),e.jsx("span",{className:"mx-2",children:"‚Ä¢"}),e.jsx("span",{className:"capitalize",children:t.property_type.toLowerCase()})]}),(t.number_of_rooms||t.number_of_bathrooms||t.number_of_kitchens||t.number_of_halls||t.number_of_parking_spaces||t.number_of_gardens)&&e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[t.number_of_rooms&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[t.number_of_rooms," chambre",t.number_of_rooms!==1?"s":""]}),t.number_of_bathrooms&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[t.number_of_bathrooms," salle",t.number_of_bathrooms!==1?"s":""," de bain"]}),t.number_of_kitchens&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:[t.number_of_kitchens," cuisine",t.number_of_kitchens!==1?"s":""]}),t.number_of_halls&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:[t.number_of_halls," hall",t.number_of_halls!==1?"s":""]}),t.number_of_parking_spaces&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:[t.number_of_parking_spaces," place",t.number_of_parking_spaces!==1?"s":""," de parking"]}),t.number_of_gardens&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-emerald-100 text-emerald-800",children:[t.number_of_gardens," jardin",t.number_of_gardens!==1?"s":""]})]}),t.description&&e.jsx("p",{className:"text-gray-700 text-sm mb-4 line-clamp-2",children:t.description}),e.jsxs("div",{className:"flex justify-between items-center pt-3 border-t border-gray-100",children:[e.jsxs("button",{onClick:()=>ie(t.id),className:"flex items-center text-green-600 hover:text-green-800 text-sm font-medium nav-transition nav-hover-scale",children:[e.jsx(ue,{className:"w-4 h-4 mr-1"}),"Photos (",t.photo_count||0,")"]}),e.jsxs("button",{onClick:()=>Ce(t),className:"flex items-center text-blue-600 hover:text-blue-800 text-sm font-medium nav-transition nav-hover-scale",children:[e.jsx(Re,{className:"w-4 h-4 mr-1"}),"Modifier"]}),e.jsxs("button",{onClick:()=>Ie(t.id),className:"flex items-center text-red-600 hover:text-red-800 text-sm font-medium nav-transition nav-hover-scale",children:[e.jsx(_e,{className:"w-4 h-4 mr-1"}),"Supprimer"]})]})]})]},t.id)):e.jsxs("div",{className:"col-span-full flex flex-col items-center justify-center py-12 text-gray-500",children:[e.jsx(we,{className:"w-16 h-16 mb-4 text-gray-400"}),e.jsx("p",{className:"text-lg font-medium",children:"Aucune propri√©t√© trouv√©e"}),e.jsx("p",{className:"text-sm mt-2",children:"Commencez par ajouter votre premi√®re propri√©t√©"})]})}),be&&e.jsx(Ue,{propertyId:be,onClose:()=>ie(null)})]})};export{Ze as default};

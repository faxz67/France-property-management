import{j as e}from"./index-BRkigiy4.js";import{r}from"./router-DUq0sin2.js";import{listProperties as U,listExpenses as X}from"./api-DQwSXtBv.js";import{R as y,P as S,a as A,C as E,T as f,L as b,B as q,X as Q,Y as G,b as H}from"./charts-DdKZH6bc.js";import"./vendor-Bzgz95E1.js";import"./icons-ByKMif1I.js";import"./utils-B9HHbEsj.js";const u=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884D8","#82CA9D","#FFC658","#FF6361","#BC5090","#58508D","#003F5C","#665191"],ae=()=>{const[p,F]=r.useState([]),[O,C]=r.useState(!0),[c,P]=r.useState(""),[o,M]=r.useState(""),[T,_]=r.useState([]),[$,k]=r.useState([]),[n,R]=r.useState(null),B=async()=>{try{C(!0);const s=await X();F(s.data?.data?.expenses||[])}catch(s){console.error("Error fetching expenses:",s),F([])}finally{C(!1)}};r.useEffect(()=>{B(),Y()},[]);const Y=async()=>{try{const s=await U(),t=s.data?.data?.properties||s.data?.data||[];k(t)}catch(s){console.error("Error fetching properties:",s),k([])}};r.useEffect(()=>{let s=p;n!==null&&(s=s.filter(t=>t.property_id===n)),(c||o)&&(s=s.filter(t=>{const i=new Date(t.created_at),g=c?new Date(c):null,j=o?new Date(o):null;return g&&j?i>=g&&i<=j:g?i>=g:j?i<=j:!0})),_(s)},[p,c,o,n]);const a=n!==null||c||o?T:p,x={};a.forEach(s=>{const t=s.category||"Miscellaneous";x[t]=(x[t]||0)+Number(s.amount||0)});const N=Object.keys(x).map(s=>({name:s,value:x[s]})),m={};a.forEach(s=>{const t=s.month||"Unknown";m[t]=(m[t]||0)+Number(s.amount||0)});const v=Object.keys(m).sort().slice(-6).map(s=>({name:s,value:m[s]})),d={"Under ‚Ç¨50":0,"‚Ç¨50 - ‚Ç¨100":0,"‚Ç¨100 - ‚Ç¨500":0,"Over ‚Ç¨500":0};a.forEach(s=>{const t=Number(s.amount||0);t<50?d["Under ‚Ç¨50"]++:t<100?d["‚Ç¨50 - ‚Ç¨100"]++:t<500?d["‚Ç¨100 - ‚Ç¨500"]++:d["Over ‚Ç¨500"]++});const D=Object.keys(d).map(s=>({name:s,value:d[s]})).filter(s=>s.value>0),z=new Date,I=`${z.getFullYear()}-${String(z.getMonth()+1).padStart(2,"0")}`,L=a.filter(s=>{const t=new Date(s.created_at);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}`===I}),h={};L.forEach(s=>{const t=new Date(s.created_at),i=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`;h[i]=(h[i]||0)+Number(s.amount||0)});const K=Object.keys(h).sort().map(s=>({date:s,amount:h[s]}));if(O)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-gray-500",children:"Chargement des donn√©es..."})});const w=$.find(s=>s.id===n),l=w?w.title||w.name||`Propri√©t√© ${n}`:null;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"üìä Analyse des D√©penses"}),n!==null&&l&&e.jsxs("div",{className:"bg-green-100 text-green-800 px-4 py-2 rounded-lg font-semibold",children:["üè† Analyse pour: ",l]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"üîç Filtres"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 items-end",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["üìä S√©lectionner une Propri√©t√© pour l'Analyse ",e.jsx("span",{className:"text-gray-500 text-xs",children:"(Isol√©)"})]}),e.jsxs("select",{value:n||"",onChange:s=>{const t=s.target.value;R(t?parseInt(t):null),console.log(`üìä Analytics filter changed to property: ${t||"all"}`)},className:"w-full px-3 py-2 border-2 border-green-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 bg-white",children:[e.jsx("option",{value:"",children:"Toutes les propri√©t√©s (Toutes les d√©penses)"}),$.map(s=>e.jsxs("option",{value:s.id,children:["üè† ",s.title||s.name||`Propri√©t√© ${s.id}`]},s.id))]}),n&&e.jsx("p",{className:"text-xs text-green-600 mt-1",children:"‚úì Analyse isol√©e pour cette propri√©t√© uniquement"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date de D√©but"}),e.jsx("input",{type:"date",value:c,onChange:s=>P(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date de Fin"}),e.jsx("input",{type:"date",value:o,onChange:s=>M(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{P(""),M(""),R(null),console.log("üìä Analytics filters cleared")},className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors",children:"Effacer les Filtres"}),e.jsx("div",{className:"text-sm text-gray-600 flex items-center",children:n!==null?e.jsxs("span",{className:"bg-green-100 text-green-800 px-3 py-2 rounded font-semibold",children:["üè† ",a.length," d√©pense(s) pour ",l||"cette propri√©t√©",a.length===0&&e.jsx("span",{className:"ml-2 text-xs",children:"(Aucune d√©pense pour cette propri√©t√©)"})]}):c||o?e.jsxs("span",{className:"bg-blue-100 text-blue-800 px-3 py-2 rounded",children:[a.length," d√©pense(s) affich√©e(s)"]}):e.jsxs("span",{className:"text-gray-500 px-3 py-2",children:["Toutes les ",p.length," d√©penses (toutes propri√©t√©s)"]})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["üí∞ R√©partition des D√©penses par Type",n!==null&&l&&e.jsxs("span",{className:"text-sm font-normal text-gray-600 ml-2",children:["(",l,")"]})]}),n!==null&&a.length===0?e.jsxs("div",{className:"text-gray-500 text-center py-12",children:[e.jsx("p",{className:"font-semibold mb-2",children:"Aucune d√©pense pour cette propri√©t√©"}),e.jsx("p",{className:"text-sm",children:"S√©lectionnez une autre propri√©t√© ou ajoutez des d√©penses"})]}):N.length>0?e.jsx(y,{width:"100%",height:300,children:e.jsxs(S,{children:[e.jsx(A,{data:N,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:80,label:!0,children:N.map((s,t)=>e.jsx(E,{fill:u[t%u.length]},`cell-${t}`))}),e.jsx(f,{}),e.jsx(b,{})]})}):e.jsx("div",{className:"text-gray-500 text-center py-12",children:"Aucune donn√©e de d√©pense encore"})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["üìÖ Distribution Mensuelle (6 Derniers Mois)",n!==null&&l&&e.jsxs("span",{className:"text-sm font-normal text-gray-600 ml-2",children:["(",l,")"]})]}),n!==null&&a.length===0?e.jsxs("div",{className:"text-gray-500 text-center py-12",children:[e.jsx("p",{className:"font-semibold mb-2",children:"Aucune d√©pense pour cette propri√©t√©"}),e.jsx("p",{className:"text-sm",children:"S√©lectionnez une autre propri√©t√© ou ajoutez des d√©penses"})]}):v.length>0?e.jsx(y,{width:"100%",height:300,children:e.jsxs(S,{children:[e.jsx(A,{data:v,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:80,label:!0,children:v.map((s,t)=>e.jsx(E,{fill:u[t%u.length]},`cell-${t}`))}),e.jsx(f,{}),e.jsx(b,{})]})}):e.jsx("div",{className:"text-gray-500 text-center py-12",children:"Aucune donn√©e mensuelle disponible"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["üìä Nombre de D√©penses par Plage de Montant",n!==null&&l&&e.jsxs("span",{className:"text-sm font-normal text-gray-600 ml-2",children:["(",l,")"]})]}),n!==null&&a.length===0?e.jsxs("div",{className:"text-gray-500 text-center py-12",children:[e.jsx("p",{className:"font-semibold mb-2",children:"Aucune d√©pense pour cette propri√©t√©"}),e.jsx("p",{className:"text-sm",children:"S√©lectionnez une autre propri√©t√© ou ajoutez des d√©penses"})]}):D.length>0?e.jsx(y,{width:"100%",height:300,children:e.jsxs(S,{children:[e.jsx(A,{data:D,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:80,label:!0,children:D.map((s,t)=>e.jsx(E,{fill:u[t%u.length]},`cell-${t}`))}),e.jsx(f,{}),e.jsx(b,{})]})}):e.jsx("div",{className:"text-gray-500 text-center py-12",children:"Aucune donn√©e de plage disponible"})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["üìà Tendance des D√©penses Quotidiennes (Mois Actuel)",n!==null&&l&&e.jsxs("span",{className:"text-sm font-normal text-gray-600 ml-2",children:["(",l,")"]})]}),n!==null&&a.length===0?e.jsxs("div",{className:"text-gray-500 text-center py-12",children:[e.jsx("p",{className:"font-semibold mb-2",children:"Aucune d√©pense pour cette propri√©t√©"}),e.jsx("p",{className:"text-sm",children:"S√©lectionnez une autre propri√©t√© ou ajoutez des d√©penses"})]}):K.length>0?e.jsx(y,{width:"100%",height:300,children:e.jsxs(q,{data:K,children:[e.jsx(Q,{dataKey:"date"}),e.jsx(G,{}),e.jsx(f,{}),e.jsx(b,{}),e.jsx(H,{dataKey:"amount",fill:"#8884d8"})]})}):e.jsx("div",{className:"text-gray-500 text-center py-12",children:"Aucune donn√©e de d√©pense pour ce mois"})]})]})]})};export{ae as default};

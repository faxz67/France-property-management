import{a as A}from"./utils-B9HHbEsj.js";const c={BASE_URL:"http://192.168.1.109:4002/api",TIMEOUT:{DEFAULT:15e3},RETRY:{MAX_ATTEMPTS:3,DELAY:1e3,BACKOFF_MULTIPLIER:2,RETRYABLE_STATUS_CODES:[408,429,500,502,503,504]},HEADERS:{ACCEPT:"application/json",CONTENT_TYPE:"application/json"}},f=e=>c.RETRY.RETRYABLE_STATUS_CODES.includes(e),_=e=>c.RETRY.DELAY*Math.pow(c.RETRY.BACKOFF_MULTIPLIER,e-1);var E=(e=>(e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.WARN=2]="WARN",e[e.ERROR=3]="ERROR",e))(E||{});class u{static instance;isDevelopment;logLevel;constructor(){this.isDevelopment=!1,this.logLevel=this.isDevelopment?0:1}static getInstance(){return u.instance||(u.instance=new u),u.instance}shouldLog(t){return t>=this.logLevel}formatMessage(t){const s=E[t.level];return`[${t.timestamp}] ${s}: ${t.message}`}getIcon(t){switch(t){case 0:return"ðŸ”";case 1:return"â„¹ï¸";case 2:return"âš ï¸";case 3:return"âŒ";default:return"ðŸ“"}}log(t,s,o,a){if(!this.shouldLog(t))return;const p={level:t,message:s,timestamp:new Date().toISOString(),context:o,error:a},d=`${this.getIcon(t)} ${this.formatMessage(p)}`;switch(t){case 0:case 1:console.log(d,o||"");break;case 2:console.warn(d,o||"");break;case 3:console.error(d,o||"",a||"");break}}debug(t,s){this.log(0,t,s)}info(t,s){this.log(1,t,s)}warn(t,s){this.log(2,t,s)}error(t,s,o){this.log(3,t,o,s)}apiRequest(t,s,o){this.debug(`API Request: ${t.toUpperCase()} ${s}`,o)}apiResponse(t,s,o,a){this.debug(`API Response: ${t.toUpperCase()} ${s} - ${o}ms (${a||"N/A"})`)}apiError(t,s,o,a){this.error(`API Error: ${t.toUpperCase()} ${s}`,o,a)}performance(t,s){s>1e3?this.warn(`Slow operation: ${t} took ${s}ms`):this.debug(`Performance: ${t} completed in ${s}ms`)}}const l=u.getInstance(),{debug:Te,info:ge,warn:Ae,error:fe,apiRequest:_e,apiResponse:$e,apiError:ye,performance:we}=l;class i extends Error{status;code;details;timestamp;constructor(t,s,o,a){super(t),this.name="ApiError",this.status=s,this.code=o,this.details=a,this.timestamp=new Date,Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}toJSON(){return{name:this.name,message:this.message,status:this.status,code:this.code,details:this.details,timestamp:this.timestamp.toISOString()}}}class m extends i{constructor(t="Erreur de connexion rÃ©seau",s){super(t,void 0,"NETWORK_ERROR",s),this.name="NetworkError"}}class $ extends i{constructor(t="Session expirÃ©e. Veuillez vous reconnecter.",s){super(t,401,"AUTHENTICATION_ERROR",s),this.name="AuthenticationError"}}class y extends i{constructor(t="AccÃ¨s refusÃ©. Permissions insuffisantes.",s){super(t,403,"AUTHORIZATION_ERROR",s),this.name="AuthorizationError"}}class w extends i{constructor(t="Ressource non trouvÃ©e.",s){super(t,404,"NOT_FOUND_ERROR",s),this.name="NotFoundError"}}class I extends i{constructor(t="Erreur de validation des donnÃ©es.",s){super(t,422,"VALIDATION_ERROR",s),this.name="ValidationError"}}class P extends i{constructor(t="Conflit. La ressource existe dÃ©jÃ .",s){super(t,409,"CONFLICT_ERROR",s),this.name="ConflictError"}}class O extends i{retryAfter;constructor(t="Trop de requÃªtes. Veuillez rÃ©essayer plus tard.",s,o){super(t,429,"RATE_LIMIT_ERROR",o),this.name="RateLimitError",this.retryAfter=s}}class b extends i{constructor(t="Erreur serveur. Veuillez rÃ©essayer plus tard.",s){super(t,500,"SERVER_ERROR",s),this.name="ServerError"}}class S extends i{constructor(t="DÃ©lai d'attente dÃ©passÃ©. Veuillez rÃ©essayer.",s){super(t,408,"TIMEOUT_ERROR",s),this.name="TimeoutError"}}function h(e){if(!e.response)return e.code==="ECONNABORTED"?new S("RequÃªte expirÃ©e. VÃ©rifiez votre connexion."):e.code==="ERR_NETWORK"?new m("Erreur rÃ©seau. VÃ©rifiez votre connexion internet."):new m("Impossible de joindre le serveur.");const{status:t,data:s}=e.response,o=s?.error||s?.message||e.message,a=s?.details;switch(t){case 401:return new $(o,a);case 403:return new y(o,a);case 404:return new w(o,a);case 409:return new P(o,a);case 422:return new I(o,a);case 429:{const p=parseInt(e.response.headers["retry-after"]||"60");return new O(o,p,a)}case 500:case 502:case 503:case 504:return new b(o,a);default:return new i(o,t,"UNKNOWN_ERROR",a)}}const C=e=>new Promise(t=>setTimeout(t,e));function D(e){e.interceptors.response.use(t=>t,async t=>{const s=t.config;s._retryCount||(s._retryCount=0);const o=t.response?.status;if(!(s._retryCount<c.RETRY.MAX_ATTEMPTS&&(!t.response||o&&f(o))))return Promise.reject(t);s._retryCount++;const p=_(s._retryCount);return l.warn(`Retrying request (attempt ${s._retryCount}/${c.RETRY.MAX_ATTEMPTS})`,{url:s.url,method:s.method}),await C(p),e(s)})}const R=c.BASE_URL;l.info("API initialized",{baseURL:R});const r=A.create({baseURL:R,withCredentials:!0,timeout:c.TIMEOUT.DEFAULT,headers:{Accept:c.HEADERS.ACCEPT,"Content-Type":c.HEADERS.CONTENT_TYPE},decompress:!0,maxRedirects:3,validateStatus:e=>e<500});D(r);r.interceptors.request.use(e=>{const t=localStorage.getItem("token");return e.metadata={startTime:Date.now()},l.apiRequest(e.method||"GET",e.url||"",{hasToken:!!t,contentType:e.headers?.["Content-Type"]}),e.data instanceof FormData&&delete e.headers["Content-Type"],t&&(e.headers=e.headers||{},e.headers.Authorization=`Bearer ${t}`),e.headers["X-Request-ID"]=`req_${Date.now()}_${Math.random().toString(36).substring(2,11)}`,e},e=>(l.error("Request interceptor error",e),Promise.reject(h(e))));r.interceptors.response.use(e=>{if(e.config.metadata){const t=Date.now()-e.config.metadata.startTime;l.apiResponse(e.config.method||"GET",e.config.url||"",t,e.status),t>3e3&&l.warn("Slow API response detected",{url:e.config.url,duration:`${t}ms`})}return e},e=>{if(e.config?.metadata){const s=Date.now()-e.config.metadata.startTime;l.apiError(e.config.method||"GET",e.config.url||"",e,{duration:`${s}ms`,status:e.response?.status})}const t=h(e);if(t.status===401){const s=e.config?.url?.includes("/auth/login"),o=window.location.pathname==="/"||window.location.pathname==="/login";!s&&!o&&(l.warn("Authentication expired, redirecting to login"),localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/")}return e.userMessage=t.message,e.apiError=t,Promise.reject(e)});const n=new Map,Ie=()=>{n.clear(),console.log("API cache cleared")},N=(e,t)=>r.post("/auth/login",{email:e,password:t}),x=()=>r.get("/auth/profile"),U=e=>(n.delete("user_profile"),r.put("/auth/profile",e)),B=e=>r.post("/auth/register",e),T=()=>r.get("/admins"),g=e=>(n.delete("admins_list"),r.post("/admins",e)),M=e=>(n.delete("admins_list"),r.delete(`/admins/${e}`)),k=(e,t)=>(n.delete("admins_list"),r.put(`/admins/${e}`,t)),v=()=>T(),F=e=>g(e),q=()=>(console.log("ðŸ”§ API: listTenants called"),console.log("ðŸ”§ Token present:",!!localStorage.getItem("token")),r.get("/tenants")),Y=e=>(n.delete("tenants_list"),r.post("/tenants",e)),L=(e,t)=>(n.delete("tenants_list"),r.put(`/tenants/${e}`,t)),z=e=>(n.delete("tenants_list"),r.delete(`/tenants/${e}`)),V=(e,t)=>r.post(`/tenants/${e}/documents`,t),W=e=>r.get(`/tenants/${e}/documents`),j=(e,t)=>r.delete(`/tenants/${e}/documents/${t}`),G=(e,t,s)=>r.put(`/tenants/${e}/documents/${t}`,{document_type:s}),H=()=>(console.log("ðŸ”§ API: listProperties called"),console.log("ðŸ”§ Token present:",!!localStorage.getItem("token")),r.get("/properties")),K=e=>(n.delete("properties_list"),r.post("/properties",e)),X=(e,t)=>(n.delete("properties_list"),r.put(`/properties/${e}`,t)),J=e=>(n.delete("properties_list"),r.delete(`/properties/${e}`)),Z=(e,t)=>r.post(`/properties/${e}/photos`,t),Q=e=>r.get(`/properties/${e}/photos`),ee=(e,t)=>r.delete(`/properties/${e}/photos/${t}`),te=(e,t)=>r.put(`/properties/${e}/photos/${t}/primary`),se=(e={})=>r.get("/bills",{params:e}),re=()=>r.get("/bills/stats"),ne=e=>r.get(`/bills/${e}`),oe=e=>(n.delete("bills_stats"),Array.from(n.keys()).forEach(t=>{t.startsWith("bills_list_")&&n.delete(t)}),r.post("/bills",e)),ae=(e,t)=>(n.delete(`bill_${e}`),n.delete("bills_stats"),Array.from(n.keys()).forEach(s=>{s.startsWith("bills_list_")&&n.delete(s)}),r.put(`/bills/${e}`,t)),ie=e=>(n.delete(`bill_${e}`),n.delete("bills_stats"),Array.from(n.keys()).forEach(t=>{t.startsWith("bills_list_")&&n.delete(t)}),r.delete(`/bills/${e}`)),le=e=>r.get(`/bills/${e}/receipts`),ce=e=>(n.delete(`bill_${e}`),n.delete("bills_stats"),n.delete("profits_total"),Array.from(n.keys()).forEach(t=>{t.startsWith("bills_list_")&&n.delete(t)}),r.put(`/bills/${e}/pay`)),ue=e=>(n.delete(`bill_${e}`),n.delete("bills_stats"),n.delete("profits_total"),Array.from(n.keys()).forEach(t=>{t.startsWith("bills_list_")&&n.delete(t)}),r.put(`/bills/${e}/undo`)),pe=()=>r.get("/bills/profits/total"),de=(e={})=>r.get("/analytics/overview",{params:e}),me=e=>(n.delete("expenses_list"),r.post("/expenses",e)),Ee=()=>r.get("/expenses"),he=e=>(n.delete("expenses_list"),r.delete(`/expenses/${e}`)),Pe={login:N,me:x,updateProfile:U,registerAdmin:B,listAdmins:T,createAdmin:g,deleteAdmin:M,updateAdmin:k,getAdmins:v,addAdmin:F,listTenants:q,createTenant:Y,updateTenant:L,deleteTenantApi:z,listProperties:H,createProperty:K,updateProperty:X,deleteProperty:J,uploadPropertyPhotos:Z,getPropertyPhotos:Q,deletePropertyPhoto:ee,setPrimaryPropertyPhoto:te,uploadTenantDocuments:V,getTenantDocuments:W,deleteTenantDocument:j,updateTenantDocumentType:G,listBills:se,getBillsStats:re,getBillById:ne,createBill:oe,updateBill:ae,deleteBill:ie,getReceiptHistory:le,markBillAsPaid:ce,undoPayment:ue,getTotalProfit:pe,getAnalyticsOverview:de,createExpense:me,listExpenses:Ee,deleteExpense:he,raw:r};export{F as addAdmin,Ie as clearCache,g as createAdmin,oe as createBill,me as createExpense,K as createProperty,Y as createTenant,Pe as default,M as deleteAdmin,ie as deleteBill,he as deleteExpense,J as deleteProperty,ee as deletePropertyPhoto,z as deleteTenantApi,j as deleteTenantDocument,v as getAdmins,de as getAnalyticsOverview,ne as getBillById,re as getBillsStats,Q as getPropertyPhotos,le as getReceiptHistory,W as getTenantDocuments,pe as getTotalProfit,T as listAdmins,se as listBills,Ee as listExpenses,H as listProperties,q as listTenants,N as login,ce as markBillAsPaid,x as me,B as registerAdmin,te as setPrimaryPropertyPhoto,ue as undoPayment,k as updateAdmin,ae as updateBill,U as updateProfile,X as updateProperty,L as updateTenant,G as updateTenantDocumentType,Z as uploadPropertyPhotos,V as uploadTenantDocuments};
